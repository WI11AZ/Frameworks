{% load static %}

<!DOCTYPE html>
<html lang="en" class="h-full bg-gray-100">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="{% static 'favicon/favicon-96x96.png' %}" sizes="96x96"/>
    <link rel="icon" type="image/svg+xml" href="{% static 'favicon/favicon.svg' %}"/>
    <link rel="shortcut icon" href="{% static 'favicon/favicon.ico' %}"/>
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'favicon/apple-touch-icon.png' %}"/>
    <meta name="apple-mobile-web-app-title" content="Anxiety Breaker"/>
    <link rel="manifest" href="/site.webmanifest"/>
    <title>Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .category-container {
            max-height: 200px;
            max-width: 900px;
            overflow: hidden; /* Cache les éléments qui dépassent */
            transition: max-height 0.4s ease-out, padding 0.4s ease-out;
            background-color: rgba(255, 255, 255, 0.1); /* Effet lumineux */
            border-radius: 8px;
            padding: 10px;
            position: relative;
        }

        .category-container:hover {
            max-height: 2000px; /* ou une grande valeur pour que l'élément s'étende */
            padding: 24px;
            background-color: rgba(255, 255, 255, 0.2);
            overflow: visible; /* Affiche tout le contenu au survol */
        }

        .category-header {
            display: flex;
            flex-direction: column;
            gap: 4px;
            color: white;
            z-index: 10;
            position: relative;
            padding-bottom: 4px;
        }

        .category-content {
            opacity: 1;
            pointer-events: auto;
            margin-top: 16px;
        }


        .role-card {
            cursor: pointer;
        }

        /* Case à droite qui reste cachée au départ */
        .case-detailed-info {
            display: none;
            position: absolute;
            top: 0;
            right: -250px; /* Positionne la case à droite de la catégorie */
            width: 250px;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1000; /* S'assure qu'elle est au-dessus des autres éléments */
            transition: right 0.3s ease; /* Ajoute une transition pour un effet fluide */
        }

        /* Active l'affichage de la case avec une animation de glissement */
        .case-detailed-info.visible {
            right: 0; /* Glisse la case vers la droite */
        }


        .hidden {
            display: none;
        }

        /* Style général des work-role (inchangé) */
        .work-role {
            cursor: pointer;
        }

        /* Style de base du detail-box (positionné dynamiquement via JavaScript) */
        .detail-box {
            position: fixed;
            right: 0;
            top: 0;
            width: 33%;
            height: 100%;
            z-index: 999;
            box-shadow: -2px 0 8px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            padding: 1.5rem;
            color: white;
            background-color: white; /* fallback */
            background-repeat: no-repeat;
            background-position: bottom right;
            background-size: 150px; /* taille raisonnable */
        }

        .bg-dd {
            background-color: #ff0000;
        }

        /* Rouge */
        .bg-io {
            background-color: #0db8c4;
        }

        /* Turquoise */
        .bg-pd {
            background-color: #ff75bc;
        }

        /* Rose */
        .bg-in {
            background-color: #6e51c7;
        }

        /* Mauve */
        .bg-ci {
            background-color: #ffd500;
        }

        /* Jaune */
        .bg-ce {
            background-color: #00c54c;
        }

        /* Vert */
        .bg-og {
            background-color: #00469c;
        }

        /* Bleu */


    </style>


</head>

<body class="h-full">
<div class="min-h-full">
    {% include "web_app/template/menu.html" %}

    <header class="bg-white shadow">
        <div class="mx-auto max-w-7xl px-4 py-6 sm:px-6 lg:px-8">
            <h1 class="text-3xl font-bold tracking-tight text-gray-900">Dashboard</h1>
        </div>
    </header>

    <main>
        <div class="mx-auto max-w-7xl px-4 py-6 sm:px-6 lg:px-8">
            {% block content %}
                <!-- Ajout des catégories et work roles ici -->
            {% endblock %}
        </div>
    </main>
</div>

<script>
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');

    // Stop the menu from being hiding or hide it
    mobileMenuButton.addEventListener('click', () => {
        // Remove the hidden class to show the menu or add it to hide it
        mobileMenu.classList.toggle('hidden');
    });


    document.addEventListener('DOMContentLoaded', () => {
        const cards = document.querySelectorAll('.work-role-card');
        const tooltip = document.getElementById('opm-tooltip');

        const opmDescriptions = {
            '2210': 'OPM 2210 : Spécialiste des systèmes informatiques',
            '0132': 'OPM 0132 : Analyste du renseignement',
            // Ajoute d’autres descriptions ici selon tes OPM_ID
        };

        cards.forEach(card => {
            card.addEventListener('mouseenter', (e) => {
                const opmId = card.getAttribute('data-opm-id');

                // surligne toutes les cartes avec le même opm_id
                document.querySelectorAll(`[data-opm-id="${opmId}"]`).forEach(c => {
                    c.classList.add('highlighted');
                });

                // affiche le tooltip s’il y a une description
                if (opmDescriptions[opmId]) {
                    tooltip.innerText = opmDescriptions[opmId];
                    tooltip.style.display = 'block';

                    // position du tooltip à droite de la souris
                    tooltip.style.left = e.pageX + 20 + 'px';
                    tooltip.style.top = e.pageY + 'px';
                }
            });

            card.addEventListener('mousemove', (e) => {
                tooltip.style.left = e.pageX + 20 + 'px';
                tooltip.style.top = e.pageY + 'px';
            });

            card.addEventListener('mouseleave', () => {
                const opmId = card.getAttribute('data-opm-id');
                document.querySelectorAll(`[data-opm-id="${opmId}"]`).forEach(c => {
                    c.classList.remove('highlighted');
                });
                tooltip.style.display = 'none';
            });
        });
    });

</script>


<script>
    function toggleDetail(workRoleId) {
        const detailBox = document.getElementById(`detail-box-${workRoleId}`);
        if (detailBox) {
            detailBox.classList.toggle('hidden');  // Toggle visibility (hidden/visible)
        }
    }
</script>


<script>
    const categoryLabels = {
      DD: "Design & Development",
      IO: "Implementation & Operation",
      PD: "Protection & Defense",
      IN: "Investigation",
      CI: "Cyberspace Intelligence",
      CE: "Cyberspace Effects",
      OG: "Oversight & Governance"
    };
    
    const backgroundColors = {
      DD: "#dc2626",
      IO: "#06b6d4",
      PD: "#ec4899",
      IN: "#8b5cf6",
      CI: "#facc15",
      CE: "#22c55e",
      OG: "#3b82f6"
    };
    
    const backgroundImages = {
      DD: 'url("/static/images/backgrounds/DD.png")',
      IO: 'url("/static/images/backgrounds/IO.png")',
      PD: 'url("/static/images/backgrounds/PD.png")',
      IN: 'url("/static/images/backgrounds/IN.png")',
      CI: 'url("/static/images/backgrounds/CI.png")',
      CE: 'url("/static/images/backgrounds/CE.png")',
      OG: 'url({% static "images/picture6.png" %})'
    };
    
    function toggleDetail(workRoleId) {
      const detailBox = document.getElementById('detail-box');
      const contentBox = document.getElementById('detail-box-content');
      const workRole = document.getElementById('work-role-' + workRoleId);
      
    
      if (!workRoleId || !workRole) {
        detailBox.classList.add('hidden');
        contentBox.innerHTML = '';
        detailBox.style.backgroundColor = '';
        detailBox.style.backgroundImage = '';
        return;
      }
    
      // Extraction du préfixe (2 premières lettres du NIST ID)
      const lastBlock = workRole.querySelectorAll('div');
      let prefix = '??';
      if (lastBlock.length) {
        const ps = lastBlock[lastBlock.length - 1].querySelectorAll('p');
        for (const p of ps) {
          const m = p.innerText.trim().match(/^([A-Z]{2})-/);
          if (m) { prefix = m[1]; break; }
        }
      }
    
      const bgColor = backgroundColors[prefix] || '#ffffff';
      const bgImage = backgroundImages[prefix] || '';
    
      console.log('toggleDetail:', prefix, bgImage);
    
      detailBox.style.backgroundColor = bgColor;
      detailBox.style.backgroundImage = bgImage;
      detailBox.style.backgroundRepeat = 'no-repeat';
      detailBox.style.backgroundSize = '350px 200px';
      detailBox.style.backgroundPosition = 'right 10px top 300px';
    
      // Génération du contenu (titre, description…)
      let html = `<h2 class="text-xl font-bold mb-4">${categoryLabels[prefix]||prefix}</h2>`;
      const descEl = workRole.querySelector('.description');
      if (descEl) html += `<p>${descEl.innerText.trim()}</p>`;
    
      contentBox.innerHTML = html;
      detailBox.classList.remove('hidden');
    }
    </script>


<script>
    function updateCompareButtonVisibility() {
        const checkboxes = document.querySelectorAll('input[type="checkbox"]');
        const compareButton = document.getElementById('compare-button');
        const checkedCount = Array.from(checkboxes).filter(cb => cb.checked).length;

        compareButton.style.display = checkedCount > 0 ? 'inline-block' : 'none';

        // Avertir si plus de 3 cases cochées
        const warning = document.getElementById('warning-message');
        if (checkedCount >6) {
            warning.style.display = 'block';
        } else {
            warning.style.display = 'none';
        }
    }

    document.addEventListener('DOMContentLoaded', function () {
        const checkboxes = document.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach(cb => cb.addEventListener('change', updateCompareButtonVisibility));
    });

    function compareSelected() {
        const selected = [];
        const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
        checkboxes.forEach(cb => {
            const workRoleCard = cb.closest('.work-role');
            if (workRoleCard) {
                selected.push(workRoleCard.id);
            }
        });
        alert("Éléments sélectionnés : " + selected.join(", "));
    }
</script>


<script>
    // 1. On ajoute un écouteur de changement sur toutes les cases à cocher
    document.querySelectorAll('input[type=checkbox]').forEach(cb => {
        cb.addEventListener('change', updateCompareButton);
    });

    function updateCompareButton() {
        // Compter le total de TOUTES les cases à cocher, pas juste celles de la zone 1
        const totalChecked = document.querySelectorAll('input[type=checkbox]:checked').length;
        const btn = document.getElementById('compare-button');
        
        // Assurons-nous que le bouton existe
        if (btn) {
            // Définir si le bouton doit être visible
            if (totalChecked > 0) {
                btn.style.removeProperty('display');
                // Si le bouton est dans un conteneur parent qui est aussi caché, rendons-le visible aussi
                if (btn.parentElement && btn.parentElement.classList.contains('detail-box') && 
                    btn.parentElement.classList.contains('hidden')) {
                    btn.parentElement.classList.remove('hidden');
                }
            } else {
                btn.style.display = 'none';
            }
            
            // Gérer le message d'avertissement à l'intérieur du bouton
            const warning = document.getElementById('warning-message');
            if (warning) {
                // Afficher l'avertissement EXACTEMENT à partir de 6 cases cochées
                if (totalChecked >= 6) {
                    warning.style.removeProperty('display');
                } else {
                    warning.style.display = 'none';
                }
            }
        }
        
        console.log('Cases cochées:', totalChecked, 'Afficher avertissement:', totalChecked >= 6);
    }

    function compareSelected() {
        const checkboxes = Array.from(document.querySelectorAll('input[type=checkbox]:checked'));

        const dcwf_ids = [];
        const ncwf_2024_ids = [];
        const ncwf_2017_ids = [];

        checkboxes.forEach(cb => {
            const name = cb.name;

            if (name.startsWith('dcwf_')) {
                const m = name.match(/dcwf_(\d+)$/);
                if (m) dcwf_ids.push(m[1]);
            } else if (name.startsWith('ncwf_2024_')) {
                const m = name.match(/ncwf_2024_(\d+)$/);
                if (m) ncwf_2024_ids.push(m[1]);
            } else if (name.startsWith('ncwf_2017_')) {
                const m = name.match(/ncwf_2017_(\d+)$/);
                if (m) ncwf_2017_ids.push(m[1]);
            }
        });

        if (dcwf_ids.length === 0 && ncwf_2024_ids.length === 0 && ncwf_2017_ids.length === 0) {
            alert('Veuillez sélectionner au moins un rôle à comparer.');
            return;
        }

        const params = new URLSearchParams();
        dcwf_ids.forEach(id => params.append('dcwf_ids', id));
        ncwf_2024_ids.forEach(id => params.append('ncwf_2024_ids', id));
        ncwf_2017_ids.forEach(id => params.append('ncwf_2017_ids', id));

        window.open(`/compare/?${params.toString()}`, '_blank');
    }
</script>















{% block scripts %}
{% endblock %}

</body>

</html>