{% extends "web_app/template/base.html" %}
{% load static %}

{% block content %}
<style>
    /* Cacher le numéro de poste sur la page d'accueil */
    #header-job-number {
        display: none !important;
    }
    
    /* Cacher la barre blanche (header) sur la page d'accueil */
    header.bg-white {
        display: none !important;
    }
    
    /* Ajuster la marge du main pour compenser la disparition du header */
    main {
        margin-top: 2rem !important; /* Seulement pour la navigation */
    }
</style>
    <main class="mx-auto max-w-7xl px-4 py-6 sm:px-6 lg:px-8">

    <!-- Image simple en haut -->
    <div class="mb-6 text-center">
        <img src="{% static 'photos_haute_qualite/bg1.png' %}" alt="Image de fond" class="mx-auto max-w-full h-auto rounded-lg shadow-md">
    </div>

    <!-- Sélecteur de modèles -->
    <div class="bg-white rounded-lg shadow-lg p-6 mb-8 border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800 mb-2 text-center underline">Sélection des versions des DCWF/NCWF Frameworks</h2>
        <h3 class="text-lg font-semibold text-gray-700 mb-4 text-center">Sélectionner le(s) modèle(s) à afficher</h3>
        
        <!-- Default Cluster -->
        <div class="bg-yellow-100 border border-yellow-300 rounded-lg p-3 mb-6">
            <p class="text-center text-yellow-800 font-medium">
                <span class="font-bold">Default Cluster:</span> DCWF 2025 + NCWF 2025
            </p>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Section DCWF -->
            <div class="space-y-4">
                <h4 class="text-lg font-semibold text-gray-700 mb-4 flex items-center">
                    <span class="w-3 h-3 bg-blue-500 rounded-full mr-3"></span>
                    DCWF (Defense Cyberspace Workforce Framework)
                </h4>
                <div class="grid grid-cols-2 gap-3">
                    <!-- DCWF 2025 -->
                    <div class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-lg p-4 shadow-md hover:shadow-lg transition-all duration-200">
                        <label class="flex items-center cursor-pointer" onclick="event.stopPropagation()">
                            <input type="checkbox" 
                                   class="model-toggle mr-3 h-5 w-5 text-purple-700 bg-white border-2 border-purple-300 rounded" 
                                   data-model="dcwf-2025"
                                   checked>
                            <span class="text-white font-semibold text-sm">DCWF 2025</span>
                        </label>
                    </div>
                    
                    <!-- DCWF 2017 -->
                    <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg p-4 shadow-md hover:shadow-lg transition-all duration-200">
                        <label class="flex items-center cursor-pointer" onclick="event.stopPropagation()">
                            <input type="checkbox" 
                                   class="model-toggle mr-3 h-5 w-5 text-blue-700 bg-white border-2 border-blue-300 rounded" 
                                   data-model="dcwf-2017">
                            <span class="text-white font-semibold text-sm">DCWF 2017</span>
                        </label>
                    </div>
                </div>
            </div>
            
            <!-- Section NCWF -->
            <div class="space-y-4">
                <h4 class="text-lg font-semibold text-gray-700 mb-4 flex items-center">
                    <span class="w-3 h-3 bg-green-500 rounded-full mr-3"></span>
                    NCWF (National Cybersecurity Workforce Framework)
                </h4>
                <div class="grid grid-cols-3 gap-3">
                    <!-- NCWF 2025 -->
                    <div class="bg-gradient-to-r from-orange-500 to-orange-600 rounded-lg p-4 shadow-md hover:shadow-lg transition-all duration-200">
                        <label class="flex items-center cursor-pointer" onclick="event.stopPropagation()">
                            <input type="checkbox" 
                                   class="model-toggle mr-3 h-5 w-5 text-orange-700 bg-white border-2 border-orange-300 rounded" 
                                   data-model="ncwf-2025"
                                   checked>
                            <div class="flex flex-col">
                                <span class="text-white font-semibold text-sm">NCWF 2025</span>
                                <span class="text-red-200 text-xs font-medium">V2.0.0</span>
                            </div>
                        </label>
                    </div>
                    
                    <!-- NCWF 2024 -->
                    <div class="bg-gradient-to-r from-red-500 to-red-600 rounded-lg p-4 shadow-md hover:shadow-lg transition-all duration-200">
                        <label class="flex items-center cursor-pointer" onclick="event.stopPropagation()">
                            <input type="checkbox" 
                                   class="model-toggle mr-3 h-5 w-5 text-red-700 bg-white border-2 border-red-300 rounded" 
                                   data-model="ncwf-2024">
                            <div class="flex flex-col">
                                <span class="text-white font-semibold text-sm">NCWF 2024</span>
                                <span class="text-red-200 text-xs font-medium">V1.0.0</span>
                            </div>
                        </label>
                    </div>
                    
                    <!-- NCWF 2017 -->
                    <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-lg p-4 shadow-md hover:shadow-lg transition-all duration-200">
                        <label class="flex items-center cursor-pointer" onclick="event.stopPropagation()">
                            <input type="checkbox" 
                                   class="model-toggle mr-3 h-5 w-5 text-green-700 bg-white border-2 border-green-300 rounded" 
                                   data-model="ncwf-2017">
                            <span class="text-white font-semibold text-sm">NCWF 2017</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Légende des couleurs -->
        <div class="mt-6 pt-4 border-t border-gray-200">
            <p class="text-sm text-gray-600 text-center">
                <span class="font-medium">Légende :</span> Chaque modèle a sa couleur distinctive pour faciliter l'identification
            </p>
        </div>
    </div>

    {% for category in categories %}
        {% if category.title == "Cybersecurity" %}
            <div class="category-container rounded-lg mt-6 relative"
                 style="background-color: rgba({{ category.color }}, 0.75);" 
                 id="category-{{ category.title|slugify }}">
                <!-- Titre + description TOUJOURS visibles -->
                <div class="category-content">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-white text-lg font-bold p-2 w-max rounded"
                         style="background-color: rgba({{ category.color }}, 1);">
                        {{ category.title }}
                        </div>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" 
                                   class="category-toggle mr-2 h-5 w-5 text-blue-600" 
                                   data-category="category-{{ category.title|slugify }}">
                            <span class="text-white font-medium">Expend</span>
                        </label>
                    </div>
                    <div class="text-white p-2">
                        {{ category.description }}
                    </div>
                </div>

                <!-- Rôles triés par ID prefix -->
                <div class="work-role-container">
                {% for line in cyber_security_lines %}
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 mt-4 pt-6">
                        {% for work_role in line %}
                            {% if work_role == None %}
                                <div class="col-span-1"></div>  {# Espace vide, transparent #}

                            {% else %}
                                <!-- Carte de work role -->
                                <div class="work-role-card bg-white rounded-lg shadow-md border-2 border-gray-300 hover:border-purple-500 transition-all duration-300 cursor-pointer relative"
                                     id="work-role-{{ work_role.id }}"
                                     data-selected="false"
                                     onclick="toggleWorkRoleCard('{{ work_role.id }}')">

                                    <!-- Zone OPM ID en haut -->
                                    <div class="px-4 pt-4 pb-2 flex flex-col items-center justify-center border-b border-gray-200">
                                        <p class="font-bold text-lg text-gray-800"
                                           style="color: rgba({{ category.color }},1);">
                                            {% if work_role.opm.id in highlight_ids %}
                                                <span class="inline-block w-3 h-3 bg-red-600 rounded-full mr-2 animate-pulse"></span>
                                            {% endif %}
                                            {{ work_role.opm.id }}
                                        </p>
                                    </div>

                                    <!-- Contenu de la carte -->
                                    <div class="px-4 py-3 space-y-2">
                                        <!-- DCWF 2025 -->
                                        {% if work_role.dcwf_2025_work_role %}
                                        <div class="work-role-zone dcwf-2025-zone flex flex-col justify-center pb-2 border-b border-purple-100">
                                            <p class="text-purple-600 text-xs font-bold mb-1">DCWF 2025</p>
                                            <p class="text-sm font-semibold text-gray-700">{{ work_role.dcwf_2025_work_role.title }}</p>
                                        </div>
                                        {% endif %}

                                        <!-- NCWF 2025 -->
                                        {% if work_role.ncwf_2025_work_role %}
                                        <div class="work-role-zone ncwf-2025-zone flex flex-col justify-center pb-2 border-b border-orange-100">
                                            <p class="text-orange-600 text-xs font-bold mb-1">NCWF 2025</p>
                                            <p class="text-xs text-gray-500">{{ work_role.ncwf_2025_work_role.ncwf_id }}</p>
                                            <p class="text-sm font-semibold text-gray-700">{{ work_role.ncwf_2025_work_role.name }}</p>
                                        </div>
                                        {% endif %}

                                        <!-- NCWF 2024 -->
                                        {% if work_role.ncwf_2024_work_role %}
                                        <div class="work-role-zone ncwf-2024-zone flex flex-col justify-center pb-2 border-b border-red-100">
                                            <p class="text-red-600 text-xs font-bold mb-1">NCWF 2024</p>
                                            <p class="text-xs text-gray-500">{{ work_role.ncwf_2024_work_role.nist_id }}</p>
                                            <p class="text-sm font-semibold text-gray-700">{{ work_role.ncwf_2024_work_role.title }}</p>
                                        </div>
                                        {% endif %}

                                        <!-- DCWF 2017 -->
                                        <div class="work-role-zone dcwf-2017-zone flex flex-col justify-center pb-2 border-b border-blue-100">
                                            <p class="text-blue-600 text-xs font-bold mb-1">DCWF 2017</p>
                                            <p class="text-sm font-semibold text-gray-700">{{ work_role.title }}</p>
                                        </div>

                                        <!-- NCWF 2017 -->
                                        {% if work_role.ncwf_2017_work_role %}
                                        <div class="work-role-zone ncwf-2017-zone flex flex-col justify-center">
                                            <p class="text-green-600 text-xs font-bold mb-1">NCWF 2017</p>
                                            <p class="text-xs text-gray-500">{{ work_role.ncwf_2017_work_role.nist_id }}</p>
                                            <p class="text-sm font-semibold text-gray-700">{{ work_role.ncwf_2017_work_role.title }}</p>
                                        </div>
                                        {% endif %}
                                    </div>

                                    <!-- Badge de sélection -->
                                    <div class="selection-badge absolute top-2 right-2 bg-green-500 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 transition-opacity duration-300">
                                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                                        </svg>
                                    </div>

                                    <!-- Données cachées -->
                                    <input type="hidden" name="work_role_{{ work_role.id }}_selected" value="false">
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endfor %}
                </div>
            </div>

        {% elif category.title == "IT (Cyberspace)" %}
            <div class="category-container rounded-lg mt-6 relative"
                 style="background-color: rgba({{ category.color }}, 0.75);"
                 id="category-{{ category.title|slugify }}">
                <!-- Titre + description TOUJOURS visibles -->
                <div class="category-content">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-white text-lg font-bold p-2 w-max rounded"
                         style="background-color: rgba({{ category.color }}, 1);">
                        {{ category.title }}
                        </div>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" 
                                   class="category-toggle mr-2 h-5 w-5 text-blue-600" 
                                   data-category="category-{{ category.title|slugify }}">
                            <span class="text-white font-medium">Expend</span>
                        </label>
                    </div>
                    <div class="text-white p-2">
                        {{ category.description }}
                    </div>
                </div>

                <!-- Rôles triés par ID prefix -->
                <div class="work-role-container">
                {% for line in it_work_lines %}
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 mt-4 pt-6">
                        {% for work_role in line %}
                            {% if work_role == None %}
                                <div class="col-span-1"></div>  {# Espace vide, transparent #}
                            {% else %}
                                <!-- Conteneur relatif pour positionner le detail-box -->
                                <div class="bg-white rounded-lg shadow-md grid grid-rows-6 work-role relative"
                                     id="work-role-{{ work_role.id }}" onclick="toggleDetail('{{ work_role.id }}')">

                                    <!-- ZONE 0 - OPM ID (toujours visible) -->
                                    <div class="px-5 pt-5 flex flex-col items-center justify-center">
                                        <p class="font-semibold text-center"
                                           style="color: rgba({{ category.color }},1);">
                                            {% if work_role.opm.id in highlight_ids %}
                                                <span class="inline-block w-2 h-2 bg-red-600 rounded-full mr-2"></span>
                                            {% endif %}
                                            {{ work_role.opm.id }}
                                        </p>
                                    </div>

                                    <!-- ZONE 1 - DCWF 2025 -->
                                    <div class="text-center px-5 py-1 flex flex-col justify-center">
                                        {% if work_role.dcwf_2025_work_role %}
                                            <p class="font-bold text-sm text-gray-600">{{ work_role.dcwf_2025_work_role.title }}</p>
                                            <input type="checkbox" name="dcwf_2025_{{ work_role.dcwf_2025_work_role.id }}"
                                                   class="form-checkbox h-5 w-5 text-purple-600 self-center mt-2">
                                            <p class="text-purple-600 text-xs font-semibold mt-1">DCWF 2025</p>
                                        {% endif %}
                                    </div>

                                    <!-- ZONE 2 - NCWF 2025 -->
                                    <div class="px-5 py-1 flex flex-col items-center justify-center">
                                        {% if work_role.ncwf_2025_work_role %}
                                            <p class="text-gray-500 text-sm font-medium text-center">{{ work_role.ncwf_2025_work_role.ncwf_id }}</p>
                                            <p class="font-normal text-sm text-gray-600 text-center">{{ work_role.ncwf_2025_work_role.name }}</p>
                                            <input type="checkbox" name="ncwf_2025_{{ work_role.ncwf_2025_work_role.id }}"
                                                   class="form-checkbox h-5 w-5 text-orange-600 self-center mt-2">
                                            <p class="text-orange-600 text-xs font-semibold mt-1">NCWF 2025</p>
                                        {% endif %}
                                    </div>

                                    <!-- ZONE 3 - NCWF 2024 -->
                                    <div class="text-center px-5 py-1 flex flex-col justify-center">
                                        {% if work_role.ncwf_2024_work_role %}
                                            <p class="text-gray-500 text-sm font-medium">{{ work_role.ncwf_2024_work_role.nist_id }}</p>
                                            <p class="font-normal text-sm text-gray-600">{{ work_role.ncwf_2024_work_role.title }}</p>
                                            <input type="checkbox" name="ncwf_2024_{{ work_role.ncwf_2024_work_role.id }}"
                                                   class="form-checkbox h-5 w-5 text-red-600 self-center mt-2">
                                            <p class="text-red-600 text-xs font-semibold mt-1">NCWF 2024</p>
                                        {% endif %}
                                    </div>

                                    <!-- ZONE 4 - DCWF 2017 -->
                                    <div class="text-center px-5 py-1 flex flex-col justify-center">
                                        <p class="font-normal text-base text-gray-600">{{ work_role.title }}</p>
                                        <input type="checkbox" name="dcwf_{{ work_role.id }}"
                                               class="form-checkbox h-5 w-5 text-blue-600 self-center mt-2">
                                        <p class="text-blue-600 text-xs font-semibold mt-1">DCWF 2017</p>
                                    </div>

                                    <!-- ZONE 5 - NCWF 2017 -->
                                    <div class="text-center px-5 pb-5 flex flex-col justify-center">
                                        {% if work_role.ncwf_2017_work_role %}
                                            <p class="text-gray-500 text-sm font-medium">{{ work_role.ncwf_2017_work_role.nist_id }}</p>
                                            <p class="font-normal text-sm text-gray-600">{{ work_role.ncwf_2017_work_role.title }}</p>
                                            <input type="checkbox" name="ncwf_2017_{{ work_role.ncwf_2017_work_role.id }}"
                                                   class="form-checkbox h-5 w-5 text-green-600 self-center mt-2">
                                            <p class="text-green-600 text-xs font-semibold mt-1">NCWF 2017</p>
                                        {% endif %}
                                    </div>

                                    <!-- Données cachées -->
                                    <p class="hidden description">{{ work_role.description }}</p>
                                    <p class="hidden ksat-id">{{ item.ncwf_2017_ksat.ncwf_id }}</p>
                                    <p class="hidden dcwf-id">{{ item.dcwf_id }}</p>
                                    <p class="hidden description">{{ item.description }}</p>
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endfor %}
                </div>
            </div>

        {% elif category.title == "Cyberspace Effects" %}
            <div class="category-container rounded-lg mt-6 relative"
                 style="background-color: rgba({{ category.color }}, 0.75);"
                 id="category-{{ category.title|slugify }}">
                <!-- Titre + description TOUJOURS visibles -->
                <div class="category-content">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-white text-lg font-bold p-2 w-max rounded"
                         style="background-color: rgba({{ category.color }}, 1);">
                        {{ category.title }}
                        </div>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" 
                                   class="category-toggle mr-2 h-5 w-5 text-blue-600" 
                                   data-category="category-{{ category.title|slugify }}">
                            <span class="text-white font-medium">Expend</span>
                        </label>
                    </div>
                    <div class="text-white p-2">
                        {{ category.description }}
                    </div>
                </div>

                <!-- Rôles triés par ID prefix -->
                <div class="work-role-container">
                {% for line in cyber_effects_work_lines %}
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 mt-4 pt-6">
                        {% for work_role in line %}
                            {% if work_role == None %}
                                <div class="col-span-1"></div>  {# Espace vide, transparent #}
        {% else %}
                                <!-- Conteneur relatif pour positionner le detail-box -->
                                <div class="bg-white rounded-lg shadow-md grid grid-rows-6 work-role relative"
                                     id="work-role-{{ work_role.id }}" onclick="toggleDetail('{{ work_role.id }}')">

                                    <!-- ZONE 0 - OPM ID (toujours visible) -->
                                    <div class="px-5 pt-5 flex flex-col items-center justify-center">
                                        <p class="font-semibold text-center"
                                           style="color: rgba({{ category.color }},1);">
                                            {% if work_role.opm.id in highlight_ids %}
                                                <span class="inline-block w-2 h-2 bg-red-600 rounded-full mr-2"></span>
                                            {% endif %}
                                            {{ work_role.opm.id }}
                                        </p>
                                    </div>

                                    <!-- ZONE 1 - DCWF 2025 -->
                                    <div class="text-center px-5 py-1 flex flex-col justify-center">
                                        {% if work_role.dcwf_2025_work_role %}
                                            <p class="font-bold text-sm text-gray-600">{{ work_role.dcwf_2025_work_role.title }}</p>
                                            <input type="checkbox" name="dcwf_2025_{{ work_role.dcwf_2025_work_role.id }}"
                                                   class="form-checkbox h-5 w-5 text-purple-600 self-center mt-2">
                                            <p class="text-purple-600 text-xs font-semibold mt-1">DCWF 2025</p>
                                        {% endif %}
                                    </div>

                                    <!-- ZONE 2 - NCWF 2025 -->
                                    <div class="px-5 py-1 flex flex-col items-center justify-center">
                                        {% if work_role.ncwf_2025_work_role %}
                                            <p class="text-gray-500 text-sm font-medium text-center">{{ work_role.ncwf_2025_work_role.ncwf_id }}</p>
                                            <p class="font-normal text-sm text-gray-600 text-center">{{ work_role.ncwf_2025_work_role.name }}</p>
                                            <input type="checkbox" name="ncwf_2025_{{ work_role.ncwf_2025_work_role.id }}"
                                                   class="form-checkbox h-5 w-5 text-orange-600 self-center mt-2">
                                            <p class="text-orange-600 text-xs font-semibold mt-1">NCWF 2025</p>
                                        {% endif %}
                                    </div>

                                    <!-- ZONE 3 - NCWF 2024 -->
                                    <div class="text-center px-5 py-1 flex flex-col justify-center">
                                        {% if work_role.ncwf_2024_work_role %}
                                            <p class="text-gray-500 text-sm font-medium">{{ work_role.ncwf_2024_work_role.nist_id }}</p>
                                            <p class="font-normal text-sm text-gray-600">{{ work_role.ncwf_2024_work_role.title }}</p>
                                            <input type="checkbox" name="ncwf_2024_{{ work_role.ncwf_2024_work_role.id }}"
                                                   class="form-checkbox h-5 w-5 text-red-600 self-center mt-2">
                                            <p class="text-red-600 text-xs font-semibold mt-1">NCWF 2024</p>
                                        {% endif %}
                                    </div>

                                    <!-- ZONE 4 - DCWF 2017 -->
                                    <div class="text-center px-5 py-1 flex flex-col justify-center">
                                        <p class="font-normal text-base text-gray-600">{{ work_role.title }}</p>
                                        <input type="checkbox" name="dcwf_{{ work_role.id }}"
                                               class="form-checkbox h-5 w-5 text-blue-600 self-center mt-2">
                                        <p class="text-blue-600 text-xs font-semibold mt-1">DCWF 2017</p>
                                    </div>

                                    <!-- ZONE 5 - NCWF 2017 -->
                                    <div class="text-center px-5 pb-5 flex flex-col justify-center">
                                        {% if work_role.ncwf_2017_work_role %}
                                            <p class="text-gray-500 text-sm font-medium">{{ work_role.ncwf_2017_work_role.nist_id }}</p>
                                            <p class="font-normal text-sm text-gray-600">{{ work_role.ncwf_2017_work_role.title }}</p>
                                            <input type="checkbox" name="ncwf_2017_{{ work_role.ncwf_2017_work_role.id }}"
                                                   class="form-checkbox h-5 w-5 text-green-600 self-center mt-2">
                                            <p class="text-green-600 text-xs font-semibold mt-1">NCWF 2017</p>
                                        {% endif %}
                                    </div>

                                    <!-- Données cachées -->
                                    <p class="hidden description">{{ work_role.description }}</p>
                                    <p class="hidden ksat-id">{{ item.ncwf_2017_ksat.ncwf_id }}</p>
                                    <p class="hidden dcwf-id">{{ item.dcwf_id }}</p>
                                    <p class="hidden description">{{ item.description }}</p>

                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endfor %}
                </div>
            </div>

        {% elif category.title == "Intelligence (Cyberspace)" %}
            <div class="category-container rounded-lg mt-6 relative"
                 style="background-color: rgba({{ category.color }}, 0.75);"
                 id="category-{{ category.title|slugify }}">
                <!-- Titre + description TOUJOURS visibles -->
                <div class="category-content">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-white text-lg font-bold p-2 w-max rounded"
                         style="background-color: rgba({{ category.color }}, 1);">
                        {{ category.title }}
                        </div>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" 
                                   class="category-toggle mr-2 h-5 w-5 text-blue-600" 
                                   data-category="category-{{ category.title|slugify }}">
                            <span class="text-white font-medium">Expend</span>
                        </label>
                    </div>
                    <div class="text-white p-2">
                        {{ category.description }}
                    </div>
                </div>

                <!-- Rôles triés par ID prefix -->
                <div class="work-role-container">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 mt-4 pt-6">
                    {% for work_role in intel_work_roles %}
                        <div class="work-role-card bg-white rounded-lg shadow-md border-2 border-gray-300 hover:border-purple-500 transition-all duration-300 cursor-pointer relative"
                             id="work-role-{{ work_role.id }}"
                             data-selected="false"
                             onclick="toggleWorkRoleCard('{{ work_role.id }}')">

                            <div class="px-4 pt-4 pb-2 flex flex-col items-center justify-center border-b border-gray-200">
                                <p class="font-bold text-lg text-gray-800"
                                   style="color: rgba({{ category.color }},1);">
                                    {% if work_role.opm.id in highlight_ids %}
                                        <span class="inline-block w-3 h-3 bg-red-600 rounded-full mr-2 animate-pulse"></span>
                                    {% endif %}
                                    {{ work_role.opm.id }}
                                </p>
                            </div>

                            <div class="px-4 py-3 space-y-2">
                                {% if work_role.ncwf_2025_work_role %}
                                <div class="work-role-zone ncwf-2025-zone flex flex-col justify-center pb-2 border-b border-orange-100">
                                    <p class="text-orange-600 text-xs font-bold mb-1">NCWF 2025</p>
                                    <p class="text-xs text-gray-500">{{ work_role.ncwf_2025_work_role.ncwf_id }}</p>
                                    <p class="text-sm font-semibold text-gray-700">{{ work_role.ncwf_2025_work_role.name }}</p>
                                </div>
                                {% endif %}

                                {% if work_role.dcwf_2025_work_role %}
                                <div class="work-role-zone dcwf-2025-zone flex flex-col justify-center pb-2 border-b border-purple-100">
                                    <p class="text-purple-600 text-xs font-bold mb-1">DCWF 2025</p>
                                    <p class="text-sm font-semibold text-gray-700">{{ work_role.dcwf_2025_work_role.title }}</p>
                                </div>
                                {% endif %}

                                {% if work_role.ncwf_2024_work_role %}
                                <div class="work-role-zone ncwf-2024-zone flex flex-col justify-center pb-2 border-b border-red-100">
                                    <p class="text-red-600 text-xs font-bold mb-1">NCWF 2024</p>
                                    <p class="text-xs text-gray-500">{{ work_role.ncwf_2024_work_role.nist_id }}</p>
                                    <p class="text-sm font-semibold text-gray-700">{{ work_role.ncwf_2024_work_role.title }}</p>
                                </div>
                                {% endif %}

                                {% if work_role.ncwf_2017_work_role %}
                                <div class="work-role-zone ncwf-2017-zone flex flex-col justify-center pb-2 border-b border-green-100">
                                    <p class="text-green-600 text-xs font-bold mb-1">NCWF 2017</p>
                                    <p class="text-xs text-gray-500">{{ work_role.ncwf_2017_work_role.nist_id }}</p>
                                    <p class="text-sm font-semibold text-gray-700">{{ work_role.ncwf_2017_work_role.title }}</p>
                                </div>
                                {% endif %}

                                <div class="work-role-zone dcwf-2017-zone flex flex-col justify-center">
                                    <p class="text-blue-600 text-xs font-bold mb-1">DCWF 2017</p>
                                    <p class="text-sm font-semibold text-gray-700">{{ work_role.title }}</p>
                                </div>
                            </div>

                            <div class="selection-badge absolute top-2 right-2 bg-green-500 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 transition-opacity duration-300">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                                </svg>
                            </div>

                            <input type="hidden" name="work_role_{{ work_role.id }}_selected" value="false">
                        </div>
                    {% endfor %}
                </div>
                </div>
            </div>

        {% elif category.title == "Cyberspace Enablers" %}
            <div class="category-container rounded-lg mt-6 relative"
                 style="background-color: rgba({{ category.color }}, 0.75);"
                 id="category-{{ category.title|slugify }}">
                <!-- Titre + description TOUJOURS visibles -->
                <div class="category-content">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-white text-lg font-bold p-2 w-max rounded"
                         style="background-color: rgba({{ category.color }}, 1);">
                        {{ category.title }}
                        </div>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" 
                                   class="category-toggle mr-2 h-5 w-5 text-blue-600" 
                                   data-category="category-{{ category.title|slugify }}">
                            <span class="text-white font-medium">Expend</span>
                        </label>
                    </div>
                    <div class="text-white p-2">
                        {{ category.description }}
                    </div>
                </div>

                <!-- Rôles triés par ID prefix -->
                <div class="work-role-container">
                {% for line in enabler_work_lines %}
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 mt-4 pt-6">
                        {% for work_role in line %}
                            {% if work_role == None %}
                                <div class="col-span-1"></div>  {# Espace vide, transparent #}
                            {% else %}
                                <!-- Conteneur relatif pour positionner le detail-box -->
                        <div class="bg-white rounded-lg shadow-md grid grid-rows-6 work-role relative"
                             id="work-role-{{ work_role.id }}" onclick="toggleDetail('{{ work_role.id }}')">

                            <!-- ZONE 0 - OPM ID (toujours visible) -->
                            <div class="px-5 pt-5 flex flex-col items-center justify-center">
                                <p class="font-semibold text-center"
                                   style="color: rgba({{ category.color }},1);">
                                    {% if work_role.opm.id in highlight_ids %}
                                        <span class="inline-block w-2 h-2 bg-red-600 rounded-full mr-2"></span>
                                    {% endif %}
                                    {{ work_role.opm.id }}
                                </p>
                            </div>

                            <!-- ZONE 1 - NCWF 2025 -->
                            <div class="px-5 py-1 flex flex-col items-center justify-center">
                                {% if work_role.ncwf_2025_work_role %}
                                    <p class="text-gray-500 text-sm font-medium text-center">{{ work_role.ncwf_2025_work_role.ncwf_id }}</p>
                                    <p class="font-bold text-sm text-gray-600 text-center">{{ work_role.ncwf_2025_work_role.name }}</p>
                                    <input type="checkbox" name="ncwf_2025_{{ work_role.ncwf_2025_work_role.id }}"
                                           class="form-checkbox h-5 w-5 text-orange-600 self-center mt-2">
                                            <p class="text-orange-600 text-xs font-semibold mt-1">NCWF 2025</p>
                                {% endif %}
                            </div>

                            <!-- ZONE 2 - DCWF 2025 -->
                            <div class="text-center px-5 py-1 flex flex-col justify-center">
                                {% if work_role.dcwf_2025_work_role %}
                                    <p class="font-normal text-sm text-gray-600">{{ work_role.dcwf_2025_work_role.title }}</p>
                                    <input type="checkbox" name="dcwf_2025_{{ work_role.dcwf_2025_work_role.id }}"
                                           class="form-checkbox h-5 w-5 text-purple-600 self-center mt-2">
                                            <p class="text-purple-600 text-xs font-semibold mt-1">DCWF 2025</p>
                                {% endif %}
                            </div>

                            <!-- ZONE 3 - NCWF 2024 -->
                            <div class="text-center px-5 py-1 flex flex-col justify-center">
                                {% if work_role.ncwf_2024_work_role %}
                                    <p class="text-gray-500 text-sm font-medium">{{ work_role.ncwf_2024_work_role.nist_id }}</p>
                                    <p class="font-normal text-sm text-gray-600">{{ work_role.ncwf_2024_work_role.title }}</p>
                                    <input type="checkbox" name="ncwf_2024_{{ work_role.ncwf_2024_work_role.id }}"
                                           class="form-checkbox h-5 w-5 text-red-600 self-center mt-2">
                                            <p class="text-red-600 text-xs font-semibold mt-1">NCWF 2024</p>
                                {% endif %}
                            </div>

                            <!-- ZONE 4 - NCWF 2017 -->
                            <div class="text-center px-5 py-1 flex flex-col justify-center">
                                {% if work_role.ncwf_2017_work_role %}
                                    <p class="text-gray-500 text-sm font-medium">{{ work_role.ncwf_2017_work_role.nist_id }}</p>
                                    <p class="font-normal text-sm text-gray-600">{{ work_role.ncwf_2017_work_role.title }}</p>
                                    <input type="checkbox" name="ncwf_2017_{{ work_role.ncwf_2017_work_role.id }}"
                                           class="form-checkbox h-5 w-5 text-green-600 self-center mt-2">
                                            <p class="text-green-600 text-xs font-semibold mt-1">NCWF 2017</p>
                                {% endif %}
                            </div>

                            <!-- ZONE 5 - DCWF (le plus ancien) -->
                            <div class="text-center px-5 pb-5 flex flex-col justify-center">
                                <p class="font-normal text-base text-gray-600">{{ work_role.title }}</p>
                                <input type="checkbox" name="dcwf_{{ work_role.id }}"
                                       class="form-checkbox h-5 w-5 text-blue-600 self-center mt-2">
                                        <p class="text-blue-600 text-xs font-semibold mt-1">DCWF 2017</p>
                            </div>

                            <!-- Données cachées -->
                            <p class="hidden description">{{ work_role.description }}</p>
                            <p class="hidden ksat-id">{{ item.ncwf_2017_ksat.ncwf_id }}</p>
                            <p class="hidden dcwf-id">{{ item.dcwf_id }}</p>
                            <p class="hidden description">{{ item.description }}</p>

                        </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endfor %}
                </div>
            </div>

        {% elif category.title == "Software Engineering" %}
            <div class="category-container rounded-lg mt-6 relative"
                 style="background-color: rgba({{ category.color }}, 0.75);"
                 id="category-{{ category.title|slugify }}">
                <!-- Titre + description TOUJOURS visibles -->
                <div class="category-content">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-white text-lg font-bold p-2 w-max rounded"
                         style="background-color: rgba({{ category.color }}, 1);">
                        {{ category.title }}
                        </div>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" 
                                   class="category-toggle mr-2 h-5 w-5 text-blue-600" 
                                   data-category="category-{{ category.title|slugify }}">
                            <span class="text-white font-medium">Expend</span>
                        </label>
                    </div>
                    <div class="text-white p-2">
                        {{ category.description }}
                    </div>
                </div>

                <!-- Rôles triés par ID prefix -->
                <div class="work-role-container">
                {% for line in software_engineering_work_lines %}
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 mt-4 pt-6">
                        {% for work_role in line %}
                            {% if work_role == None %}
                                <div class="col-span-1"></div>  {# Espace vide, transparent #}
                            {% else %}
                                <!-- Conteneur relatif pour positionner le detail-box -->
                                <div class="bg-white rounded-lg shadow-md grid grid-rows-6 work-role relative"
                                     id="work-role-{{ work_role.id }}" onclick="toggleDetail('{{ work_role.id }}')">

                                    <!-- ZONE 0 - OPM ID (toujours visible) -->
                                    <div class="px-5 pt-5 flex flex-col items-center justify-center">
                                        <p class="font-semibold text-center"
                                           style="color: rgba({{ category.color }},1);">
                                            {% if work_role.opm.id in highlight_ids %}
                                                <span class="inline-block w-2 h-2 bg-red-600 rounded-full mr-2"></span>
                                            {% endif %}
                                            {{ work_role.opm.id }}
                                        </p>
                                    </div>

                                    <!-- ZONE 1 - DCWF 2025 -->
                                    <div class="text-center px-5 py-1 flex flex-col justify-center">
                                        {% if work_role.dcwf_2025_work_role %}
                                            <p class="font-bold text-sm text-gray-600">{{ work_role.dcwf_2025_work_role.title }}</p>
                                            <input type="checkbox" name="dcwf_2025_{{ work_role.dcwf_2025_work_role.id }}"
                                                   class="form-checkbox h-5 w-5 text-purple-600 self-center mt-2">
                                            <p class="text-purple-600 text-xs font-semibold mt-1">DCWF 2025</p>
                                        {% endif %}
                                    </div>

                                    <!-- ZONE 2 - NCWF 2025 -->
                                    <div class="px-5 py-1 flex flex-col items-center justify-center">
                                        {% if work_role.ncwf_2025_work_role %}
                                            <p class="text-gray-500 text-sm font-medium text-center">{{ work_role.ncwf_2025_work_role.ncwf_id }}</p>
                                            <p class="font-normal text-sm text-gray-600 text-center">{{ work_role.ncwf_2025_work_role.name }}</p>
                                            <input type="checkbox" name="ncwf_2025_{{ work_role.ncwf_2025_work_role.id }}"
                                                   class="form-checkbox h-5 w-5 text-orange-600 self-center mt-2">
                                            <p class="text-orange-600 text-xs font-semibold mt-1">NCWF 2025</p>
                                        {% endif %}
                                    </div>

                                    <!-- ZONE 3 - NCWF 2024 -->
                                    <div class="text-center px-5 py-1 flex flex-col justify-center">
                                        {% if work_role.ncwf_2024_work_role %}
                                            <p class="text-gray-500 text-sm font-medium">{{ work_role.ncwf_2024_work_role.nist_id }}</p>
                                            <p class="font-normal text-sm text-gray-600">{{ work_role.ncwf_2024_work_role.title }}</p>
                                            <input type="checkbox" name="ncwf_2024_{{ work_role.ncwf_2024_work_role.id }}"
                                                   class="form-checkbox h-5 w-5 text-red-600 self-center mt-2">
                                            <p class="text-red-600 text-xs font-semibold mt-1">NCWF 2024</p>
                                        {% endif %}
                                    </div>

                                    <!-- ZONE 4 - DCWF 2017 -->
                                    <div class="text-center px-5 py-1 flex flex-col justify-center">
                                        <p class="font-normal text-base text-gray-600">{{ work_role.title }}</p>
                                        <input type="checkbox" name="dcwf_{{ work_role.id }}"
                                               class="form-checkbox h-5 w-5 text-blue-600 self-center mt-2">
                                        <p class="text-blue-600 text-xs font-semibold mt-1">DCWF 2017</p>
                                    </div>

                                    <!-- ZONE 5 - NCWF 2017 -->
                                    <div class="text-center px-5 pb-5 flex flex-col justify-center">
                                        {% if work_role.ncwf_2017_work_role %}
                                            <p class="text-gray-500 text-sm font-medium">{{ work_role.ncwf_2017_work_role.nist_id }}</p>
                                            <p class="font-normal text-sm text-gray-600">{{ work_role.ncwf_2017_work_role.title }}</p>
                                            <input type="checkbox" name="ncwf_2017_{{ work_role.ncwf_2017_work_role.id }}"
                                                   class="form-checkbox h-5 w-5 text-green-600 self-center mt-2">
                                            <p class="text-green-600 text-xs font-semibold mt-1">NCWF 2017</p>
                                        {% endif %}
                                    </div>

                                    <!-- Données cachées -->
                                    <p class="hidden description">{{ work_role.description }}</p>
                                    <p class="hidden ksat-id">{{ item.ncwf_2017_ksat.ncwf_id }}</p>
                                    <p class="hidden dcwf-id">{{ item.dcwf_id }}</p>
                                    <p class="hidden description">{{ item.description }}</p>

            </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endfor %}
                </div>
            </div>

        {% elif category.title == "Data/AI" %}
            <div class="category-container rounded-lg mt-6 relative"
                 style="background-color: rgba({{ category.color }}, 0.75);"
                 id="category-{{ category.title|slugify }}">
                <!-- Titre + description TOUJOURS visibles -->
                <div class="category-content">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-white text-lg font-bold p-2 w-max rounded"
                         style="background-color: rgba({{ category.color }}, 1);">
                        {{ category.title }}
                        </div>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" 
                                   class="category-toggle mr-2 h-5 w-5 text-blue-600" 
                                   data-category="category-{{ category.title|slugify }}">
                            <span class="text-white font-medium">Expend</span>
                        </label>
                    </div>
                    <div class="text-white p-2">
                        {{ category.description }}
                    </div>
                </div>

                <!-- Rôles triés par ID prefix -->
                <div class="work-role-container">
                {% for line in data_work_lines %}
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 mt-4 pt-6">
                        {% for work_role in line %}
                            {% if work_role == None %}
                                <div class="col-span-1"></div>  {# Espace vide, transparent #}
                            {% else %}
                                <!-- Conteneur relatif pour positionner le detail-box -->
                                <div class="bg-white rounded-lg shadow-md grid grid-rows-6 work-role relative"
                                     id="work-role-{{ work_role.id }}" onclick="toggleDetail('{{ work_role.id }}')">

                                    <!-- ZONE 0 - OPM ID (toujours visible) -->
                                    <div class="px-5 pt-5 flex flex-col items-center justify-center">
                                        <p class="font-semibold text-center"
                                           style="color: rgba({{ category.color }},1);">
                                            {% if work_role.opm.id in highlight_ids %}
                                                <span class="inline-block w-2 h-2 bg-red-600 rounded-full mr-2"></span>
                                            {% endif %}
                                            {{ work_role.opm.id }}
                                        </p>
                                    </div>

                                    <!-- ZONE 1 - DCWF 2025 -->
                                    <div class="text-center px-5 py-1 flex flex-col justify-center">
                                        {% if work_role.dcwf_2025_work_role %}
                                            <p class="font-bold text-sm text-gray-600">{{ work_role.dcwf_2025_work_role.title }}</p>
                                            <input type="checkbox" name="dcwf_2025_{{ work_role.dcwf_2025_work_role.id }}"
                                                   class="form-checkbox h-5 w-5 text-purple-600 self-center mt-2">
                                            <p class="text-purple-600 text-xs font-semibold mt-1">DCWF 2025</p>
                                        {% endif %}
                                    </div>

                                    <!-- ZONE 2 - NCWF 2025 -->
                                    <div class="px-5 py-1 flex flex-col items-center justify-center">
                                        {% if work_role.ncwf_2025_work_role %}
                                            <p class="text-gray-500 text-sm font-medium text-center">{{ work_role.ncwf_2025_work_role.ncwf_id }}</p>
                                            <p class="font-normal text-sm text-gray-600 text-center">{{ work_role.ncwf_2025_work_role.name }}</p>
                                            <input type="checkbox" name="ncwf_2025_{{ work_role.ncwf_2025_work_role.id }}"
                                                   class="form-checkbox h-5 w-5 text-orange-600 self-center mt-2">
                                            <p class="text-orange-600 text-xs font-semibold mt-1">NCWF 2025</p>
                                        {% endif %}
                                    </div>

                                    <!-- ZONE 3 - NCWF 2024 -->
                                    <div class="text-center px-5 py-1 flex flex-col justify-center">
                                        {% if work_role.ncwf_2024_work_role %}
                                            <p class="text-gray-500 text-sm font-medium">{{ work_role.ncwf_2024_work_role.nist_id }}</p>
                                            <p class="font-normal text-sm text-gray-600">{{ work_role.ncwf_2024_work_role.title }}</p>
                                            <input type="checkbox" name="ncwf_2024_{{ work_role.ncwf_2024_work_role.id }}"
                                                   class="form-checkbox h-5 w-5 text-red-600 self-center mt-2">
                                            <p class="text-red-600 text-xs font-semibold mt-1">NCWF 2024</p>
                                        {% endif %}
                                    </div>

                                    <!-- ZONE 4 - DCWF 2017 -->
                                    <div class="text-center px-5 py-1 flex flex-col justify-center">
                                        <p class="font-normal text-base text-gray-600">{{ work_role.title }}</p>
                                        <input type="checkbox" name="dcwf_{{ work_role.id }}"
                                               class="form-checkbox h-5 w-5 text-blue-600 self-center mt-2">
                                        <p class="text-blue-600 text-xs font-semibold mt-1">DCWF 2017</p>
                                    </div>

                                    <!-- ZONE 5 - NCWF 2017 -->
                                    <div class="text-center px-5 pb-5 flex flex-col justify-center">
                                        {% if work_role.ncwf_2017_work_role %}
                                            <p class="text-gray-500 text-sm font-medium">{{ work_role.ncwf_2017_work_role.nist_id }}</p>
                                            <p class="font-normal text-sm text-gray-600">{{ work_role.ncwf_2017_work_role.title }}</p>
                                            <input type="checkbox" name="ncwf_2017_{{ work_role.ncwf_2017_work_role.id }}"
                                                   class="form-checkbox h-5 w-5 text-green-600 self-center mt-2">
                                            <p class="text-green-600 text-xs font-semibold mt-1">NCWF 2017</p>
                                        {% endif %}
                                    </div>

                                    <!-- Données cachées -->
                                    <p class="hidden description">{{ work_role.description }}</p>
                                    <p class="hidden ksat-id">{{ item.ncwf_2017_ksat.ncwf_id }}</p>
                                    <p class="hidden dcwf-id">{{ item.dcwf_id }}</p>
                                    <p class="hidden description">{{ item.description }}</p>

                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endfor %}
                </div>
            </div>

        {% endif %}
    {% endfor %}

    <!-- Catégorie Without Community pour les work roles NCWF 2025 sans correspondance DCWF -->
    <div class="category-container rounded-lg mt-6 relative"
         style="background-color: rgba(128, 128, 128, 0.75);" 
         id="category-without-community">
        <!-- Titre + description TOUJOURS visibles -->
        <div class="category-content">
            <div class="flex items-center justify-between mb-4">
                <div class="text-white text-lg font-bold p-2 w-max rounded"
                     style="background-color: rgba(128, 128, 128, 1);">
                    Without Community
                </div>
                <label class="flex items-center cursor-pointer">
                    <input type="checkbox" 
                           class="category-toggle mr-2 h-5 w-5 text-blue-600" 
                           data-category="category-without-community">
                    <span class="text-white font-medium">Expend</span>
                </label>
            </div>
            <div class="text-white p-2">
                Not (yet) attributed to any DCWF Workforce Element​
            </div>
        </div>

        <!-- Work roles sans correspondance DCWF -->
        <div class="work-role-container">
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 mt-4 pt-6">
            <!-- PD-WRL-005 -->
            <div class="bg-white rounded-lg shadow-md grid grid-rows-6 work-role relative"
                 id="work-role-pd-wrl-005">
                
                <!-- ZONE 0 - NCWF ID -->
                <div class="px-5 pt-5 flex flex-col items-center justify-center">
                    <p class="font-semibold text-center text-gray-600">
                        PD-WRL-005
                    </p>
                </div>

                <!-- ZONE 1 - DCWF 2025 (vide) -->
                <div class="text-center px-5 py-1 flex flex-col justify-center">
                </div>

                <!-- ZONE 2 - NCWF 2025 -->
                <div class="px-5 py-1 flex flex-col items-center justify-center">
                    <p class="text-gray-500 text-sm font-medium text-center">PD-WRL-005</p>
                    <p class="font-bold text-sm text-gray-600 text-center">Insider Threat Analysis</p>
                    <input type="checkbox" name="ncwf_2025_pd_wrl_005"
                           class="form-checkbox h-5 w-5 text-orange-600 self-center mt-2">
                    <p class="text-orange-600 text-xs font-semibold mt-1">NCWF 2025</p>
                </div>

                <!-- ZONE 3 - NCWF 2024 (vide) -->
                <div class="text-center px-5 py-1 flex flex-col justify-center">
                </div>

                <!-- ZONE 4 - DCWF 2017 (vide) -->
                <div class="text-center px-5 py-1 flex flex-col justify-center">
                </div>

                <!-- ZONE 5 - NCWF 2017 (vide) -->
                <div class="text-center px-5 pb-5 flex flex-col justify-center">
                </div>

                <!-- Données cachées -->
                <p class="hidden description">Responsible for identifying and assessing the capabilities and activities of cybersecurity insider threats; produces findings to help initialize and support law enforcement and counterintelligence activities and investigations.</p>
            </div>

            <!-- DD-WRL-009 -->
            <div class="bg-white rounded-lg shadow-md grid grid-rows-6 work-role relative"
                 id="work-role-dd-wrl-009">
                
                <!-- ZONE 0 - NCWF ID -->
                <div class="px-5 pt-5 flex flex-col items-center justify-center">
                    <p class="font-semibold text-center text-gray-600">
                        DD-WRL-009
                    </p>
                </div>

                <!-- ZONE 1 - DCWF 2025 (vide) -->
                <div class="text-center px-5 py-1 flex flex-col justify-center">
                </div>

                <!-- ZONE 2 - NCWF 2025 -->
                <div class="px-5 py-1 flex flex-col items-center justify-center">
                    <p class="text-gray-500 text-sm font-medium text-center">DD-WRL-009</p>
                    <p class="font-bold text-sm text-gray-600 text-center">Operational Technology (OT) Cybersecurity Engineering</p>
                    <input type="checkbox" name="ncwf_2025_dd_wrl_009"
                           class="form-checkbox h-5 w-5 text-orange-600 self-center mt-2">
                    <p class="text-orange-600 text-xs font-semibold mt-1">NCWF 2025</p>
                </div>

                <!-- ZONE 3 - NCWF 2024 (vide) -->
                <div class="text-center px-5 py-1 flex flex-col justify-center">
                </div>

                <!-- ZONE 4 - DCWF 2017 (vide) -->
                <div class="text-center px-5 py-1 flex flex-col justify-center">
                </div>

                <!-- ZONE 5 - NCWF 2017 (vide) -->
                <div class="text-center px-5 pb-5 flex flex-col justify-center">
                </div>

                <!-- Données cachées -->
                <p class="hidden description">Responsible for working within the engineering department to design and create systems, processes, and procedures that maintain the safety, reliability, controllability, and security of industrial systems in the face of intentional and incidental cyber-related events. Interfaces with Chief Information Security Officer, plant managers, and industrial cybersecurity technicians.</p>
            </div>
        </div>
        </div>
    </div>

    <!-- Ligne de séparation pour les catégories non-officielles -->
    <div class="mt-8 mb-6">
        <div class="border-t-2 border-gray-400 border-dashed"></div>
        <div class="text-center mt-2">
            <span class="text-gray-600 text-sm font-medium bg-white px-4 py-1 rounded-full border border-gray-300">
                ⚠️ Catégories non-officielles
            </span>
        </div>
    </div>

    <!-- Catégorie Emerging AI work roles with Real Impact (SANS) -->
    <div class="category-container rounded-lg mt-6 relative"
         style="background-color: rgba(88, 28, 135, 0.75);" 
         id="category-emerging-ai-work-roles">
        <!-- Titre + description TOUJOURS visibles -->
        <div class="category-content">
            <div class="flex items-center justify-between mb-4">
                <div class="text-white text-lg font-bold p-2 w-max rounded"
                     style="background-color: rgba(88, 28, 135, 1);">
                    Emerging AI work roles with Real Impact (SANS)
                </div>
                <label class="flex items-center cursor-pointer">
                    <input type="checkbox" 
                           class="category-toggle mr-2 h-5 w-5 text-blue-600" 
                           data-category="category-emerging-ai-work-roles">
                    <span class="text-white font-medium">Expend</span>
                </label>
            </div>
            <div class="text-white p-2">
                Two years of industry tracking reveal these EMERGING AI cybersecurity roles.<br>
                We observed NEW AI cybersecurity roles maturing through SANS Summit presentations, expert discussions, course development, and community insights.<br>
                The focus: defending the nation's new AI technological capabilities.
            </div>
            
            <!-- Work Roles AI -->
            <div class="work-role-container">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    {% for ai_work_role in ai_work_roles %}
                    <div class="work-role bg-white bg-opacity-10 rounded-lg p-4 border border-white border-opacity-20 relative" 
                         id="work-role-{{ ai_work_role.id }}" onclick="toggleDetail('{{ ai_work_role.id }}')">
                        <div class="flex items-center cursor-pointer">
                            <span class="text-gray-800 font-medium">{{ ai_work_role.title }}</span>
                        </div>
                        
                        <!-- Données cachées pour la fenêtre latérale -->
                        <p class="hidden description">{{ ai_work_role.description }}</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- Catégorie Cyberspace Operations and Electromagnetic Warfare / FM 3-12 (2021) -->
    <div class="category-container rounded-lg mt-6 relative"
         style="background-color: rgba(139, 69, 19, 0.75);" 
         id="category-cyberspace-operations-electromagnetic-warfare">
        <!-- Titre + description TOUJOURS visibles -->
        <div class="category-content p-6">
            <div class="flex items-center justify-between mb-4">
                <div class="text-white text-lg font-bold p-2 w-max rounded"
                     style="background-color: rgba(139, 69, 19, 1);">
                    Cyberspace Operations and Electromagnetic Warfare / FM 3-12 (2021)
                </div>
                <label class="flex items-center cursor-pointer">
                    <input type="checkbox" 
                           class="category-toggle mr-2 h-5 w-5 text-blue-600" 
                           data-category="category-cyberspace-operations-electromagnetic-warfare">
                    <span class="text-white font-medium">Expend</span>
                </label>
            </div>
            <div class="text-white p-2">
                The Cyberspace Electromagnetic Activities workroles CEMA are responsible for synchronizing and integrating cyberspace operations and EW with the operations process and through other integrating processes.
            </div>
            
            <!-- Work Roles CEMA -->
            <div class="work-role-container">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    {% for work_role in cema_category.dcwf_work_roles.all %}
                    <div class="work-role bg-white bg-opacity-10 rounded-lg p-4 border border-white border-opacity-20 relative" 
                         id="work-role-{{ work_role.id }}" onclick="toggleDetail('{{ work_role.id }}')">
                        <div class="flex items-center cursor-pointer">
                            <span class="text-gray-800 font-medium">{{ work_role.title }}</span>
                        </div>
                        
                        <!-- Données cachées pour la fenêtre latérale -->
                        <p class="hidden description">{{ work_role.description }}</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <!-- Publication info en bas -->
            <div class="text-white text-sm mt-4 p-2 text-center">
                Publication available @ Army Publishing Directorate site (https://armypubs.army.mil), and @ Central Army Registry site (https://atiam.train.army.mil/catalog/dashboard)
            </div>
        </div>
    </div>

    </main>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Gestion des cases à cocher pour le déroulement des catégories
        document.querySelectorAll('.category-toggle').forEach(checkbox => {
            checkbox.addEventListener('change', function(event) {
                const categoryId = this.getAttribute('data-category');
                const categoryContainer = document.getElementById(categoryId);
                
                if (categoryContainer) {
                    if (this.checked) {
                        categoryContainer.classList.add('expanded');
                        // Ajuster les hauteurs des work roles quand la catégorie s'expand
                        setTimeout(() => {
                            adjustWorkRoleHeights();
                            adjustLongTitleWorkRoles();
                        }, 100);
                    } else {
                        categoryContainer.classList.remove('expanded');
                    }
                }
                
                // Empêcher la propagation du clic
                event.stopPropagation();
            });
            
            // Empêcher que le clic sur la case à cocher déclenche d'autres événements
            checkbox.addEventListener('click', function(event) {
                event.stopPropagation();
            });
        });

        // Gestion des clics sur les work roles pour afficher les détails
        document.querySelectorAll('.work-role').forEach(workRole => {
            workRole.addEventListener('click', function(event) {
                // Ne pas déclencher si on clique sur une checkbox
                if (event.target.type === 'checkbox') {
                    return;
                }
                
                const workRoleId = this.id.replace('work-role-', '');
                toggleDetail(workRoleId);
            });
        });

        // Gestion des checkboxes : afficher la fenêtre de détails quand on clique sur une checkbox
        document.querySelectorAll('.work-role input[type="checkbox"]:not(.model-toggle)').forEach(checkbox => {
            checkbox.addEventListener('click', function(event) {
                // Empêcher la propagation pour éviter le double événement
                event.stopPropagation();
                
                // Trouver le work role parent et ouvrir sa fenêtre de détails
                const workRole = this.closest('.work-role');
                if (workRole) {
                    const workRoleId = workRole.id.replace('work-role-', '');
                    toggleDetail(workRoleId);
                }
            });
        });

        // Initialiser le bouton de comparaison
        // updateCompareButton(); // Supprimé car plus de bouton de comparaison
        
        // Gestion des sélecteurs de modèles (zone de sélection uniquement)
        let isUpdatingCheckboxes = false; // Flag pour éviter les boucles infinies
        
        document.querySelectorAll('.model-toggle').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                if (isUpdatingCheckboxes) return; // Éviter les boucles infinies
                
                const modelType = this.getAttribute('data-model');
                const isChecked = this.checked;
                
                // Co-sélection automatique entre DCWF 2017 et NCWF 2017
                if (modelType === 'dcwf-2017' || modelType === 'ncwf-2017') {
                    const otherModelType = modelType === 'dcwf-2017' ? 'ncwf-2017' : 'dcwf-2017';
                    const otherCheckbox = document.querySelector(`input[data-model="${otherModelType}"]`);
                    
                    if (otherCheckbox) {
                        isUpdatingCheckboxes = true;
                        otherCheckbox.checked = isChecked;
                        isUpdatingCheckboxes = false;
                        
                        // Synchroniser aussi l'affichage des zones
                        toggleModelVisibility(otherModelType, isChecked);
                    }
                }
                
                // Co-sélection automatique entre DCWF 2025 et NCWF 2025
                if (modelType === 'dcwf-2025' || modelType === 'ncwf-2025') {
                    const otherModelType = modelType === 'dcwf-2025' ? 'ncwf-2025' : 'dcwf-2025';
                    const otherCheckbox = document.querySelector(`input[data-model="${otherModelType}"]`);
                    
                    if (otherCheckbox) {
                        isUpdatingCheckboxes = true;
                        otherCheckbox.checked = isChecked;
                        isUpdatingCheckboxes = false;
                        
                        // Synchroniser aussi l'affichage des zones
                        toggleModelVisibility(otherModelType, isChecked);
                    }
                }
                
                // Masquer/afficher les zones correspondantes
                toggleModelVisibility(modelType, isChecked);
                
                // Ajuster la taille des work roles
                adjustWorkRoleHeights();
            });
        });
        
        // Initialiser les modèles par défaut (DCWF 2025 et NCWF 2025) EN PREMIER
        initializeDefaultModelSelectors();
        
        // Ajuster la taille initiale après l'initialisation complète des modèles
        setTimeout(() => {
            adjustWorkRoleHeights();
            adjustLongTitleWorkRoles();
        }, 200);
        
        // Ajouter des event listeners sur TOUS les checkboxes des work roles pour l'adaptation en temps réel
        const allWorkRoleCheckboxes = document.querySelectorAll('.work-role input[type="checkbox"]');
        allWorkRoleCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                // Ignorer les décochages automatiques lors du masquage des modèles
                if (this.hasAttribute('data-auto-uncheck')) {
                    return;
                }
                
                // Co-sélection automatique des cases dans les work roles
                const checkboxName = this.name;
                const isChecked = this.checked;
                
                // Co-sélection DCWF 2025 ↔ NCWF 2025
                if (checkboxName.startsWith('dcwf_2025_')) {
                    const ncwf25Checkbox = this.closest('.work-role').querySelector('input[name^="ncwf_2025_"]');
                    if (ncwf25Checkbox) {
                        ncwf25Checkbox.checked = isChecked;
                    }
                } else if (checkboxName.startsWith('ncwf_2025_')) {
                    const dcwf25Checkbox = this.closest('.work-role').querySelector('input[name^="dcwf_2025_"]');
                    if (dcwf25Checkbox) {
                        dcwf25Checkbox.checked = isChecked;
                    }
                }
                
                // Gestion spéciale pour les work roles "Without Community" (pas de co-sélection DCWF)
                if (checkboxName.startsWith('ncwf_2025_pd_wrl_005') || checkboxName.startsWith('ncwf_2025_dd_wrl_009')) {
                    // Ces work roles n'ont pas de correspondance DCWF, donc pas de co-sélection
                    // Ils restent uniquement NCWF 2025
                }
                
                // Co-sélection DCWF 2017 ↔ NCWF 2017
                if (checkboxName.startsWith('dcwf_') && !checkboxName.startsWith('dcwf_2025_')) {
                    const ncwf17Checkbox = this.closest('.work-role').querySelector('input[name^="ncwf_2017_"]');
                    if (ncwf17Checkbox) {
                        ncwf17Checkbox.checked = isChecked;
                    }
                } else if (checkboxName.startsWith('ncwf_2017_')) {
                    const dcwf17Checkbox = this.closest('.work-role').querySelector('input[name^="dcwf_"]:not([name^="dcwf_2025_"])');
                    if (dcwf17Checkbox) {
                        dcwf17Checkbox.checked = isChecked;
                    }
                }
                
                // Ajuster les hauteurs en temps réel quand l'utilisateur coche/décoche
                setTimeout(() => {
                    adjustWorkRoleHeights();
                    // Ajustement spécial pour les work roles avec des titres longs
                    adjustLongTitleWorkRoles();
                }, 10);
            });
        });
    });

    // Fonction pour masquer/afficher les zones selon le modèle sélectionné
    function toggleModelVisibility(modelType, isVisible) {
        // Gestion spéciale pour la catégorie "Without Community"
        if (modelType === 'ncwf-2025') {
            const withoutCommunityCategory = document.getElementById('category-without-community');
            if (withoutCommunityCategory) {
                if (isVisible) {
                    withoutCommunityCategory.style.display = 'block';
                    // S'assurer que les work roles sont masqués par défaut (pas expanded)
                    withoutCommunityCategory.classList.remove('expanded');
                } else {
                    withoutCommunityCategory.style.display = 'none';
                }
            }
        } else if (modelType === 'dcwf-2025') {
            // Masquer la catégorie "Without Community" quand DCWF 2025 est décoché
            const withoutCommunityCategory = document.getElementById('category-without-community');
            if (withoutCommunityCategory) {
                withoutCommunityCategory.style.display = 'none';
            }
        }
        
        const workRoles = document.querySelectorAll('.work-role');
        
        workRoles.forEach(workRole => {
            let targetZone;
            
            switch(modelType) {
                case 'ncwf-2025':
                    // Chercher la zone NCWF 2025 par le nom du checkbox
                    const ncwf25Checkbox = workRole.querySelector('input[name^="ncwf_2025_"]');
                    if (ncwf25Checkbox) targetZone = ncwf25Checkbox.closest('div');
                    break;
                case 'dcwf-2025':
                    // Chercher la zone DCWF 2025 par le nom du checkbox
                    const dcwf25Checkbox = workRole.querySelector('input[name^="dcwf_2025_"]');
                    if (dcwf25Checkbox) targetZone = dcwf25Checkbox.closest('div');
                    break;
                case 'ncwf-2024':
                    // Chercher la zone NCWF 2024 par le nom du checkbox
                    const ncwf24Checkbox = workRole.querySelector('input[name^="ncwf_2024_"]');
                    if (ncwf24Checkbox) targetZone = ncwf24Checkbox.closest('div');
                    break;
                case 'ncwf-2017':
                    // Chercher la zone NCWF 2017 par le nom du checkbox
                    const ncwf17Checkbox = workRole.querySelector('input[name^="ncwf_2017_"]');
                    if (ncwf17Checkbox) targetZone = ncwf17Checkbox.closest('div');
                    break;
                case 'dcwf-2017':
                    // Chercher la zone DCWF 2017 par le nom du checkbox (sans année)
                    const workRoleId = workRole.id.replace("work-role-", "");
                    const dcwf17Checkbox = workRole.querySelector(`input[name="dcwf_${workRoleId}"]`);
                    if (dcwf17Checkbox) targetZone = dcwf17Checkbox.closest('div');
                    break;
            }
            
            if (targetZone) {
                if (isVisible) {
                    targetZone.style.display = 'flex';
                } else {
                    targetZone.style.display = 'none';
                    // Décocher automatiquement les cases du modèle caché
                    const checkbox = targetZone.querySelector('input[type="checkbox"]');
                    if (checkbox) {
                        // Marquer temporairement pour éviter la co-sélection automatique
                        checkbox.setAttribute('data-auto-uncheck', 'true');
                        checkbox.checked = false;
                        checkbox.removeAttribute('data-auto-uncheck');
                    }
                }
            }
        });
        
        // Ajuster les hauteurs après avoir changé la visibilité
        setTimeout(() => {
            adjustWorkRoleHeights();
        }, 50);
    }

    // Fonction pour afficher/masquer la fenêtre de détails (renommée pour éviter le conflit)
    function toggleDetailHome(workRoleId) {
        // Utiliser la fonction simple de base.html pour les work roles AI
        const detailBox = document.getElementById(`detail-box-${workRoleId}`);
        if (detailBox) {
            detailBox.classList.toggle('hidden');  // Toggle visibility (hidden/visible)
        }
    }

    // Fonction pour sélectionner/désélectionner une carte de work role
    function toggleWorkRoleCard(workRoleId) {
        const card = document.getElementById('work-role-' + workRoleId);
        if (!card) return;

        const isSelected = card.getAttribute('data-selected') === 'true';
        const hiddenInput = card.querySelector('input[type="hidden"]');
        const badge = card.querySelector('.selection-badge');

        if (isSelected) {
            // Désélectionner
            card.setAttribute('data-selected', 'false');
            card.classList.remove('selected');
            card.style.borderColor = '';
            card.style.backgroundColor = '';
            badge.style.opacity = '0';
            if (hiddenInput) hiddenInput.value = 'false';
        } else {
            // Sélectionner
            card.setAttribute('data-selected', 'true');
            card.classList.add('selected');
            card.style.borderColor = '#a855f7';
            card.style.backgroundColor = '#faf5ff';
            badge.style.opacity = '1';
            if (hiddenInput) hiddenInput.value = 'true';
        }
    }

    
    // Fonction pour ajuster la hauteur des work roles selon le contenu réel
    function adjustWorkRoleHeights() {
        const workRoles = document.querySelectorAll('.work-role');
        
        workRoles.forEach(workRole => {
            // Temporairement mettre la hauteur en auto pour mesurer le contenu réel
            workRole.style.height = 'auto';
            workRole.style.minHeight = 'auto';
            
            // Récupérer toutes les zones visibles
            const visibleZones = [];
            const zones = workRole.querySelectorAll('div');
            
            // Zone 0 (OPM ID) toujours visible
            const opmZone = zones[0];
            if (opmZone) visibleZones.push(opmZone);
            
            // Vérifier chaque zone de modèle (1 à 5) en utilisant les checkboxes pour identifier les zones
            // Zone 1 - DCWF 2025
            const dcwf25Checkbox = workRole.querySelector('input[name^="dcwf_2025_"]');
            if (dcwf25Checkbox && window.getComputedStyle(dcwf25Checkbox.closest('div')).display !== 'none') {
                visibleZones.push(dcwf25Checkbox.closest('div'));
            }
            
            // Zone 2 - NCWF 2025
            const ncwf25Checkbox = workRole.querySelector('input[name^="ncwf_2025_"]');
            if (ncwf25Checkbox && window.getComputedStyle(ncwf25Checkbox.closest('div')).display !== 'none') {
                visibleZones.push(ncwf25Checkbox.closest('div'));
            }
            
            // Zone 3 - NCWF 2024
            const ncwf24Checkbox = workRole.querySelector('input[name^="ncwf_2024_"]');
            if (ncwf24Checkbox && window.getComputedStyle(ncwf24Checkbox.closest('div')).display !== 'none') {
                visibleZones.push(ncwf24Checkbox.closest('div'));
            }
            
            // Zone 4 - DCWF 2017 (utiliser l'ID du work role)
            const workRoleId = workRole.id.replace("work-role-", "");
            const dcwf17Checkbox = workRole.querySelector(`input[name="dcwf_${workRoleId}"]`);
            if (dcwf17Checkbox && window.getComputedStyle(dcwf17Checkbox.closest('div')).display !== 'none') {
                visibleZones.push(dcwf17Checkbox.closest('div'));
            }
            
            // Zone 5 - NCWF 2017
            const ncwf17Checkbox = workRole.querySelector('input[name^="ncwf_2017_"]');
            if (ncwf17Checkbox && window.getComputedStyle(ncwf17Checkbox.closest('div')).display !== 'none') {
                visibleZones.push(ncwf17Checkbox.closest('div'));
            }
            
            // Calculer la hauteur réelle du contenu
            let totalHeight = 0;
            let totalPadding = 0;
            
            visibleZones.forEach((zone, index) => {
                // Mesurer la hauteur réelle de la zone
                const zoneHeight = zone.scrollHeight;
                const computedStyle = window.getComputedStyle(zone);
                const paddingTop = parseFloat(computedStyle.paddingTop);
                const paddingBottom = parseFloat(computedStyle.paddingBottom);
                
                totalHeight += zoneHeight;
                totalPadding += paddingTop + paddingBottom;
                
                // Ajouter un petit espacement entre les zones (sauf pour la dernière)
                if (index < visibleZones.length - 1) {
                    totalHeight += 6; // 6px d'espacement entre zones (réduit)
                }
            });
            
            // Ajouter un padding minimal pour l'esthétique et s'assurer qu'il y a assez d'espace
            const aestheticPadding = 20; // 10px en haut et 10px en bas (augmenté)
            const finalHeight = Math.max(120, totalHeight + aestheticPadding + 10); // +10px de sécurité
            
            // Appliquer la hauteur calculée
            workRole.style.height = `${finalHeight}px`;
            workRole.style.minHeight = `${finalHeight}px`;
            
            // Ajuster le grid-rows pour correspondre au nombre de zones visibles
            workRole.style.gridTemplateRows = `repeat(${visibleZones.length}, 1fr)`;
        });
    }
    
    // Fonction spéciale pour ajuster les work roles avec des titres longs
    function adjustLongTitleWorkRoles() {
        const workRoles = document.querySelectorAll('.work-role');
        
        workRoles.forEach(workRole => {
            // Vérifier si la zone DCWF 2017 est visible (maintenant en zone 4)
            const workRoleId = workRole.id.replace("work-role-", "");
            const dcwf17Checkbox = workRole.querySelector(`input[name="dcwf_${workRoleId}"]`);
            
            if (dcwf17Checkbox && window.getComputedStyle(dcwf17Checkbox.closest('div')).display !== 'none') {
                const dcwf17Zone = dcwf17Checkbox.closest('div');
                const titleElement = dcwf17Zone.querySelector('p');
                
                if (titleElement) {
                    // Mesurer la hauteur du texte
                    const textHeight = titleElement.scrollHeight;
                    const lineHeight = parseFloat(window.getComputedStyle(titleElement).lineHeight);
                    const lines = Math.ceil(textHeight / lineHeight);
                    
                    // Si le texte fait plus d'une ligne, ajuster la hauteur
                    if (lines > 1) {
                        const additionalHeight = (lines - 1) * lineHeight + 20; // 20px de marge supplémentaire
                        const currentHeight = parseInt(workRole.style.height) || 120;
                        workRole.style.height = `${currentHeight + additionalHeight}px`;
                        workRole.style.minHeight = `${currentHeight + additionalHeight}px`;
                    }
                }
            }
        });
    }

    // Fonction pour initialiser les modèles par défaut (DCWF 2025 et NCWF 2025 uniquement)
    function initializeDefaultModelSelectors() {
        // D'abord, s'assurer que toutes les catégories sont non-expanded par défaut
        document.querySelectorAll('.category-container').forEach(category => {
            category.classList.remove('expanded');
        });
        
        // Masquer toutes les zones
        hideAllModelZones();
        
        // Masquer la catégorie "Without Community" par défaut
        const withoutCommunityCategory = document.getElementById('category-without-community');
        if (withoutCommunityCategory) {
            withoutCommunityCategory.style.display = 'none';
            // S'assurer que la classe expanded n'est pas présente au démarrage
            withoutCommunityCategory.classList.remove('expanded');
        }
        
        // Cocher DCWF 2025 par défaut
        const dcwf25Checkboxes = document.querySelectorAll('input[data-model="dcwf-2025"]');
        dcwf25Checkboxes.forEach(checkbox => {
            checkbox.checked = true;
            // Ne pas déclencher l'événement change pour éviter les conflits
        });
        
        // Cocher NCWF 2025 par défaut
        const ncwf25Checkboxes = document.querySelectorAll('input[data-model="ncwf-2025"]');
        ncwf25Checkboxes.forEach(checkbox => {
            checkbox.checked = true;
            // Ne pas déclencher l'événement change pour éviter les conflits
        });
        
        // Maintenant appliquer la visibilité des zones pour les modèles cochés
        toggleModelVisibility('dcwf-2025', true);
        toggleModelVisibility('ncwf-2025', true);
        
        // Ajuster les hauteurs des work roles après la configuration des zones
        setTimeout(() => {
            adjustWorkRoleHeights();
            adjustLongTitleWorkRoles();
        }, 50);
        
        // DCWF 2017 reste décoché par défaut
    }
    
    // Fonction pour masquer toutes les zones de modèles
    function hideAllModelZones() {
        const workRoles = document.querySelectorAll('.work-role');
        
        workRoles.forEach(workRole => {
            // Masquer NCWF 2025
            const ncwf25Checkbox = workRole.querySelector('input[name^="ncwf_2025_"]');
            if (ncwf25Checkbox) {
                const zone = ncwf25Checkbox.closest('div');
                if (zone) zone.style.display = 'none';
            }
            
            // Masquer DCWF 2025
            const dcwf25Checkbox = workRole.querySelector('input[name^="dcwf_2025_"]');
            if (dcwf25Checkbox) {
                const zone = dcwf25Checkbox.closest('div');
                if (zone) zone.style.display = 'none';
            }
            
            // Masquer NCWF 2024
            const ncwf24Checkbox = workRole.querySelector('input[name^="ncwf_2024_"]');
            if (ncwf24Checkbox) {
                const zone = ncwf24Checkbox.closest('div');
                if (zone) zone.style.display = 'none';
            }
            
            // Masquer NCWF 2017
            const ncwf17Checkbox = workRole.querySelector('input[name^="ncwf_2017_"]');
            if (ncwf17Checkbox) {
                const zone = ncwf17Checkbox.closest('div');
                if (zone) zone.style.display = 'none';
            }
            
            // Masquer DCWF 2017 (utiliser l'ID du work role)
            const workRoleId = workRole.id.replace("work-role-", "");
            const dcwf17Checkbox = workRole.querySelector(`input[name="dcwf_${workRoleId}"]`);
            if (dcwf17Checkbox) {
                const zone = dcwf17Checkbox.closest('div');
                if (zone) zone.style.display = 'none';
            }
        });
        
        // Ajuster les hauteurs après avoir masqué toutes les zones
        setTimeout(() => {
            adjustWorkRoleHeights();
        }, 50);
    }
    
    // Fonction pour compter le nombre de modèles cochés dans la zone de sélection
    function getCheckedModelSelectorsCount() {
        const checkedCheckboxes = document.querySelectorAll('.model-toggle:checked');
        return checkedCheckboxes.length;
    }
    
</script>

<style>
    /* Styles pour les work roles vraiment adaptatifs */
    .work-role {
        min-height: 120px; /* Hauteur minimale augmentée */
        transition: all 0.3s ease;
        height: auto; /* Hauteur flexible */
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        overflow: visible; /* Permettre le débordement si nécessaire */
    }
    
    /* Optimiser l'espacement des zones */
    .work-role > div {
        padding: 0.4rem !important; /* Padding encore plus réduit */
        flex-shrink: 0; /* Empêcher la compression */
        min-height: fit-content; /* S'assurer que la zone s'adapte au contenu */
    }
    
    .work-role > div:first-child {
        padding-top: 0.75rem !important; /* Zone OPM ID */
        padding-bottom: 0.25rem !important;
    }
    
    .work-role > div:last-child {
        padding-bottom: 1rem !important; /* Zone NCWF 2017 - plus d'espace en bas */
        padding-top: 0.25rem !important;
        margin-bottom: 0.5rem !important; /* Marge supplémentaire en bas */
    }
    
    /* Assurer que le contenu s'adapte */
    .work-role > div > p {
        margin: 0.1rem 0 !important; /* Marges encore plus minimales */
        line-height: 1.1 !important; /* Ligne de base plus compacte */
        word-wrap: break-word; /* Permettre la coupure des mots longs */
        overflow-wrap: break-word;
    }
    
    .work-role > div > input {
        margin: 0.2rem 0 !important; /* Marge minimale pour les checkboxes */
    }
    
    /* Spécifiquement pour les zones DCWF 2017 qui ont des titres plus longs (maintenant en zone 4) */
    .work-role > div:nth-child(5) > p {
        font-size: 0.875rem !important; /* Taille de police légèrement réduite */
        line-height: 1.1 !important;
        max-height: none !important; /* Pas de limite de hauteur */
    }
    
    .work-role:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }
    
    /* Couleurs distinctes pour chaque zone */
    .work-role input[name^="dcwf_"]:not([name*="2025"]) {
        border-color: #3b82f6; /* Bleu pour DCWF */
    }
    
    .work-role input[name^="ncwf_2017_"] {
        border-color: #10b981; /* Vert pour NCWF 2017 */
    }
    
    .work-role input[name^="ncwf_2024_"] {
        border-color: #ef4444; /* Rouge pour NCWF 2024 */
    }
    
    .work-role input[name^="dcwf_2025_"] {
        border-color: #9333ea; /* Mauve pour DCWF 2025 */
    }
    
    .work-role input[name^="ncwf_2025_"] {
        border-color: #ea580c; /* Orange pour NCWF 2025 */
    }
    
    /* Masquer les work roles par défaut */
    .category-container .work-role-container {
        display: none;
    }
    
    /* Afficher les work roles quand la catégorie est expanded */
    .category-container.expanded .work-role-container {
        display: grid;
    }
    
        /* Navigation fixe en haut */
        nav.bg-gray-800 {
            position: fixed !important;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000 !important;
            width: 100%;
        }
        
        /* Header fixe en dessous de la navigation */
        header.bg-white {
            position: fixed !important;
            top: 4rem; /* En dessous de la navigation */
            left: 0;
            right: 0;
            z-index: 999 !important;
            width: 100%;
        }
        
        /* Ajuster le contenu principal pour compenser la navigation et le header fixes */
        main {
            margin-top: 4rem; /* Espace très minimal pour la navigation + header fixes */
        }

        /* Styles pour les cartes de work role */
        .work-role-card {
            min-height: 200px;
            transition: all 0.3s ease;
            background-color: white;
        }

        .work-role-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
        }

        .work-role-card.selected {
            border-color: #a855f7 !important;
            background-color: #faf5ff !important;
            box-shadow: 0 8px 20px rgba(168, 85, 247, 0.3);
        }

        .work-role-zone {
            min-height: 40px;
        }

        .work-role-zone p {
            margin: 0.1rem 0;
            line-height: 1.3;
        }

        .selection-badge {
            pointer-events: none;
        }

        .work-role-card .grid {
            display: block;
        }
    </style>

{% endblock %}
