{% extends "web_app/template/base.html" %}

{% block content %}
    <main class="mx-auto max-w-7xl px-4 py-6 sm:px-6 lg:px-8">

    <!-- Sélecteur de modèles -->
    <div class="bg-white rounded-lg shadow-lg p-6 mb-8 border border-gray-200">
        <h3 class="text-xl font-bold text-gray-800 mb-6 text-center">Sélectionner les modèles à afficher</h3>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Section DCWF -->
            <div class="space-y-4">
                <h4 class="text-lg font-semibold text-gray-700 mb-4 flex items-center">
                    <span class="w-3 h-3 bg-blue-500 rounded-full mr-3"></span>
                    DCWF (Defense Cyberspace Workforce Framework)
                </h4>
                <div class="grid grid-cols-2 gap-3">
                    <!-- DCWF 2025 -->
                    <div class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-lg p-4 shadow-md hover:shadow-lg transition-all duration-200">
                        <label class="flex items-center cursor-pointer" onclick="event.stopPropagation()">
                            <input type="checkbox" 
                                   class="model-toggle mr-3 h-5 w-5 text-purple-700 bg-white border-2 border-purple-300 rounded" 
                                   data-model="dcwf-2025"
                                   checked>
                            <span class="text-white font-semibold text-sm">DCWF 2025</span>
                        </label>
                    </div>
                    
                    <!-- DCWF 2017 -->
                    <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg p-4 shadow-md hover:shadow-lg transition-all duration-200">
                        <label class="flex items-center cursor-pointer" onclick="event.stopPropagation()">
                            <input type="checkbox" 
                                   class="model-toggle mr-3 h-5 w-5 text-blue-700 bg-white border-2 border-blue-300 rounded" 
                                   data-model="dcwf-2017">
                            <span class="text-white font-semibold text-sm">DCWF 2017</span>
                        </label>
                    </div>
                </div>
            </div>
            
            <!-- Section NCWF -->
            <div class="space-y-4">
                <h4 class="text-lg font-semibold text-gray-700 mb-4 flex items-center">
                    <span class="w-3 h-3 bg-green-500 rounded-full mr-3"></span>
                    NCWF (National Cybersecurity Workforce Framework)
                </h4>
                <div class="grid grid-cols-3 gap-3">
                    <!-- NCWF 2025 -->
                    <div class="bg-gradient-to-r from-orange-500 to-orange-600 rounded-lg p-4 shadow-md hover:shadow-lg transition-all duration-200">
                        <label class="flex items-center cursor-pointer" onclick="event.stopPropagation()">
                            <input type="checkbox" 
                                   class="model-toggle mr-3 h-5 w-5 text-orange-700 bg-white border-2 border-orange-300 rounded" 
                                   data-model="ncwf-2025"
                                   checked>
                            <span class="text-white font-semibold text-sm">NCWF 2025</span>
                        </label>
                    </div>
                    
                    <!-- NCWF 2024 -->
                    <div class="bg-gradient-to-r from-red-500 to-red-600 rounded-lg p-4 shadow-md hover:shadow-lg transition-all duration-200">
                        <label class="flex items-center cursor-pointer" onclick="event.stopPropagation()">
                            <input type="checkbox" 
                                   class="model-toggle mr-3 h-5 w-5 text-red-700 bg-white border-2 border-red-300 rounded" 
                                   data-model="ncwf-2024">
                            <span class="text-white font-semibold text-sm">NCWF 2024</span>
                        </label>
                    </div>
                    
                    <!-- NCWF 2017 -->
                    <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-lg p-4 shadow-md hover:shadow-lg transition-all duration-200">
                        <label class="flex items-center cursor-pointer" onclick="event.stopPropagation()">
                            <input type="checkbox" 
                                   class="model-toggle mr-3 h-5 w-5 text-green-700 bg-white border-2 border-green-300 rounded" 
                                   data-model="ncwf-2017">
                            <span class="text-white font-semibold text-sm">NCWF 2017</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Légende des couleurs -->
        <div class="mt-6 pt-4 border-t border-gray-200">
            <p class="text-sm text-gray-600 text-center">
                <span class="font-medium">Légende :</span> Chaque modèle a sa couleur distinctive pour faciliter l'identification
            </p>
        </div>
    </div>

    {% for category in categories %}
        {% if category.title == "Cybersecurity" %}
            <div class="category-container rounded-lg mt-6 relative"
                 style="background-color: rgba({{ category.color }}, 0.75);" 
                 id="category-{{ category.title|slugify }}">
                <!-- Titre + description TOUJOURS visibles -->
                <div class="category-content">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-white text-lg font-bold p-2 w-max rounded"
                         style="background-color: rgba({{ category.color }}, 1);">
                        {{ category.title }}
                        </div>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" 
                                   class="category-toggle mr-2 h-5 w-5 text-blue-600" 
                                   data-category="category-{{ category.title|slugify }}">
                            <span class="text-white font-medium">Dérouler</span>
                        </label>
                    </div>
                    <div class="text-white p-2">
                        {{ category.description }}
                    </div>
                </div>

                <!-- Rôles triés par ID prefix -->
                {% for line in cyber_security_lines %}
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 mt-4 pt-6">
                        {% for work_role in line %}
                            {% if work_role == None %}
                                <div class="col-span-1"></div>  {# Espace vide, transparent #}

                            {% else %}
                                <!-- Conteneur relatif pour positionner le detail-box -->
                                <div class="bg-white rounded-lg shadow-md grid grid-rows-6 work-role relative"
                                     id="work-role-{{ work_role.id }}" onclick="toggleDetail('{{ work_role.id }}')">

                                    <!-- ZONE 0 - OPM ID (toujours visible) -->
                                    <div class="px-5 pt-5 flex flex-col items-center justify-center">
                                        <p class="font-semibold text-center"
                                           style="color: rgba({{ category.color }},1);">
                                            {% if work_role.opm.id in highlight_ids %}
                                                <span class="inline-block w-2 h-2 bg-red-600 rounded-full mr-2"></span>
                                            {% endif %}
                                            {{ work_role.opm.id }}
                                        </p>
                                    </div>

                                    <!-- ZONE 1 - NCWF 2025 -->
                                    <div class="px-5 py-1 flex flex-col items-center justify-center">
                                        {% if work_role.ncwf_2025_work_role %}
                                            <p class="text-gray-500 text-sm font-medium text-center">{{ work_role.ncwf_2025_work_role.ncwf_id }}</p>
                                            <p class="font-bold text-sm text-gray-600 text-center">{{ work_role.ncwf_2025_work_role.ncwf_title }}</p>
                                            <input type="checkbox" name="ncwf_2025_{{ work_role.ncwf_2025_work_role.id }}"
                                                   class="form-checkbox h-5 w-5 text-purple-600 self-center mt-2">
                                            <p class="text-purple-600 text-xs font-semibold mt-1">NCWF 2025</p>
                                        {% endif %}
                                    </div>

                                    <!-- ZONE 2 - DCWF 2025 -->
                                    <div class="text-center px-5 py-1 flex flex-col justify-center">
                                        {% if work_role.dcwf_2025_work_role %}
                                            <p class="font-normal text-sm text-gray-600">{{ work_role.dcwf_2025_work_role.title }}</p>
                                            <input type="checkbox" name="dcwf_2025_{{ work_role.dcwf_2025_work_role.id }}"
                                                   class="form-checkbox h-5 w-5 text-indigo-600 self-center mt-2">
                                            <p class="text-indigo-600 text-xs font-semibold mt-1">DCWF 2025</p>
                                        {% endif %}
                                    </div>

                                    <!-- ZONE 3 - NCWF 2024 -->
                                    <div class="text-center px-5 py-1 flex flex-col justify-center">
                                        {% if work_role.ncwf_2024_work_role %}
                                            <p class="text-gray-500 text-sm font-medium">{{ work_role.ncwf_2024_work_role.nist_id }}</p>
                                            <p class="font-normal text-sm text-gray-600">{{ work_role.ncwf_2024_work_role.title }}</p>
                                            <input type="checkbox" name="ncwf_2024_{{ work_role.ncwf_2024_work_role.id }}"
                                                   class="form-checkbox h-5 w-5 text-red-600 self-center mt-2">
                                            <p class="text-red-600 text-xs font-semibold mt-1">NCWF 2024</p>
                                        {% endif %}
                                    </div>

                                    <!-- ZONE 4 - NCWF 2017 -->
                                    <div class="text-center px-5 py-1 flex flex-col justify-center">
                                        {% if work_role.ncwf_2017_work_role %}
                                            <p class="text-gray-500 text-sm font-medium">{{ work_role.ncwf_2017_work_role.nist_id }}</p>
                                            <p class="font-normal text-sm text-gray-600">{{ work_role.ncwf_2017_work_role.title }}</p>
                                            <input type="checkbox" name="ncwf_2017_{{ work_role.ncwf_2017_work_role.id }}"
                                                   class="form-checkbox h-5 w-5 text-green-600 self-center mt-2">
                                            <p class="text-green-600 text-xs font-semibold mt-1">NCWF 2017</p>
                                        {% endif %}
                                    </div>

                                    <!-- ZONE 5 - DCWF (le plus ancien) -->
                                    <div class="text-center px-5 pb-5 flex flex-col justify-center">
                                        <p class="font-normal text-base text-gray-600">{{ work_role.title }}</p>
                                        <input type="checkbox" name="dcwf_{{ work_role.id }}"
                                               class="form-checkbox h-5 w-5 text-blue-600 self-center mt-2">
                                        <p class="text-blue-600 text-xs font-semibold mt-1">DCWF 2017</p>
                                    </div>

                                    <!-- Données cachées -->
                                    <p class="hidden description">{{ work_role.description }}</p>
                                    <p class="hidden ksat-id">{{ item.ncwf_2017_ksat.ncwf_id }}</p>
                                    <p class="hidden dcwf-id">{{ item.dcwf_id }}</p>
                                    <p class="hidden description">{{ item.description }}</p>

                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endfor %}
            </div>

        {% elif category.title == "IT (Cyberspace)" %}
            <div class="category-container rounded-lg mt-6 relative"
                 style="background-color: rgba({{ category.color }}, 0.75);"
                 id="category-{{ category.title|slugify }}">
                <!-- Titre + description TOUJOURS visibles -->
                <div class="category-content">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-white text-lg font-bold p-2 w-max rounded"
                         style="background-color: rgba({{ category.color }}, 1);">
                        {{ category.title }}
                        </div>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" 
                                   class="category-toggle mr-2 h-5 w-5 text-blue-600" 
                                   data-category="category-{{ category.title|slugify }}">
                            <span class="text-white font-medium">Dérouler</span>
                        </label>
                    </div>
                    <div class="text-white p-2">
                        {{ category.description }}
                    </div>
                </div>

                <!-- Rôles triés par ID prefix -->
                {% for line in it_work_lines %}
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 mt-4 pt-6">
                        {% for work_role in line %}
                            {% if work_role == None %}
                                <div class="col-span-1"></div>  {# Espace vide, transparent #}
                            {% else %}
                                <!-- Conteneur relatif pour positionner le detail-box -->
                                <div class="bg-white rounded-lg shadow-md grid grid-rows-6 work-role relative"
                                     id="work-role-{{ work_role.id }}" onclick="toggleDetail('{{ work_role.id }}')">

                                    <!-- ZONE 0 - OPM ID (toujours visible) -->
                                    <div class="px-5 pt-5 flex flex-col items-center justify-center">
                                        <p class="font-semibold text-center"
                                           style="color: rgba({{ category.color }},1);">
                                            {% if work_role.opm.id in highlight_ids %}
                                                <span class="inline-block w-2 h-2 bg-red-600 rounded-full mr-2"></span>
                                            {% endif %}
                                            {{ work_role.opm.id }}
                                        </p>
                                    </div>

                                    <!-- ZONE 1 - NCWF 2025 -->
                                    <div class="px-5 py-1 flex flex-col items-center justify-center">
                                        {% if work_role.ncwf_2025_work_role %}
                                            <p class="text-gray-500 text-sm font-medium text-center">{{ work_role.ncwf_2025_work_role.ncwf_id }}</p>
                                            <p class="font-bold text-sm text-gray-600 text-center">{{ work_role.ncwf_2025_work_role.ncwf_title }}</p>
                                            <input type="checkbox" name="ncwf_2025_{{ work_role.ncwf_2025_work_role.id }}"
                                                   class="form-checkbox h-5 w-5 text-purple-600 self-center mt-2">
                                            <p class="text-purple-600 text-xs font-semibold mt-1">NCWF 2025</p>
                                        {% endif %}
                                    </div>

                                    <!-- ZONE 2 - DCWF 2025 -->
                                    <div class="text-center px-5 py-1 flex flex-col justify-center">
                                        {% if work_role.dcwf_2025_work_role %}
                                            <p class="font-normal text-sm text-gray-600">{{ work_role.dcwf_2025_work_role.title }}</p>
                                            <input type="checkbox" name="dcwf_2025_{{ work_role.dcwf_2025_work_role.id }}"
                                                   class="form-checkbox h-5 w-5 text-indigo-600 self-center mt-2">
                                            <p class="text-indigo-600 text-xs font-semibold mt-1">DCWF 2025</p>
                                        {% endif %}
                                    </div>

                                    <!-- ZONE 3 - NCWF 2024 -->
                                    <div class="text-center px-5 py-1 flex flex-col justify-center">
                                        {% if work_role.ncwf_2024_work_role %}
                                            <p class="text-gray-500 text-sm font-medium">{{ work_role.ncwf_2024_work_role.nist_id }}</p>
                                            <p class="font-normal text-sm text-gray-600">{{ work_role.ncwf_2024_work_role.title }}</p>
                                            <input type="checkbox" name="ncwf_2024_{{ work_role.ncwf_2024_work_role.id }}"
                                                   class="form-checkbox h-5 w-5 text-red-600 self-center mt-2">
                                            <p class="text-red-600 text-xs font-semibold mt-1">NCWF 2024</p>
                                        {% endif %}
                                    </div>

                                    <!-- ZONE 4 - NCWF 2017 -->
                                    <div class="text-center px-5 py-1 flex flex-col justify-center">
                                        {% if work_role.ncwf_2017_work_role %}
                                            <p class="text-gray-500 text-sm font-medium">{{ work_role.ncwf_2017_work_role.nist_id }}</p>
                                            <p class="font-normal text-sm text-gray-600">{{ work_role.ncwf_2017_work_role.title }}</p>
                                            <input type="checkbox" name="ncwf_2017_{{ work_role.ncwf_2017_work_role.id }}"
                                                   class="form-checkbox h-5 w-5 text-green-600 self-center mt-2">
                                            <p class="text-green-600 text-xs font-semibold mt-1">NCWF 2017</p>
                                        {% endif %}
                                    </div>

                                    <!-- ZONE 5 - DCWF (le plus ancien) -->
                                    <div class="text-center px-5 pb-5 flex flex-col justify-center">
                                        <p class="font-normal text-base text-gray-600">{{ work_role.title }}</p>
                                        <input type="checkbox" name="dcwf_{{ work_role.id }}"
                                               class="form-checkbox h-5 w-5 text-blue-600 self-center mt-2">
                                        <p class="text-blue-600 text-xs font-semibold mt-1">DCWF 2017</p>
                                    </div>

                                    <!-- Données cachées -->
                                    <p class="hidden description">{{ work_role.description }}</p>
                                    <p class="hidden ksat-id">{{ item.ncwf_2017_ksat.ncwf_id }}</p>
                                    <p class="hidden dcwf-id">{{ item.dcwf_id }}</p>
                                    <p class="hidden description">{{ item.description }}</p>
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endfor %}
            </div>

        {% elif category.title == "Cyberspace Effects" %}
            <div class="category-container rounded-lg mt-6 relative"
                 style="background-color: rgba({{ category.color }}, 0.75);"
                 id="category-{{ category.title|slugify }}">
                <!-- Titre + description TOUJOURS visibles -->
                <div class="category-content">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-white text-lg font-bold p-2 w-max rounded"
                         style="background-color: rgba({{ category.color }}, 1);">
                        {{ category.title }}
                        </div>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" 
                                   class="category-toggle mr-2 h-5 w-5 text-blue-600" 
                                   data-category="category-{{ category.title|slugify }}">
                            <span class="text-white font-medium">Dérouler</span>
                        </label>
                    </div>
                    <div class="text-white p-2">
                        {{ category.description }}
                    </div>
                </div>

                <!-- Rôles triés par ID prefix -->
                {% for line in cyber_effects_work_lines %}
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 mt-4 pt-6">
                        {% for work_role in line %}
                            {% if work_role == None %}
                                <div class="col-span-1"></div>  {# Espace vide, transparent #}
        {% else %}
                                <!-- Conteneur relatif pour positionner le detail-box -->
                                <div class="bg-white rounded-lg shadow-md grid grid-rows-6 work-role relative"
                                     id="work-role-{{ work_role.id }}" onclick="toggleDetail('{{ work_role.id }}')">

                                    <!-- ZONE 0 - OPM ID (toujours visible) -->
                                    <div class="px-5 pt-5 flex flex-col items-center justify-center">
                                        <p class="font-semibold text-center"
                                           style="color: rgba({{ category.color }},1);">
                                            {% if work_role.opm.id in highlight_ids %}
                                                <span class="inline-block w-2 h-2 bg-red-600 rounded-full mr-2"></span>
                                            {% endif %}
                                            {{ work_role.opm.id }}
                                        </p>
                                    </div>

                                    <!-- ZONE 1 - NCWF 2025 -->
                                    <div class="px-5 py-1 flex flex-col items-center justify-center">
                                        {% if work_role.ncwf_2025_work_role %}
                                            <p class="text-gray-500 text-sm font-medium text-center">{{ work_role.ncwf_2025_work_role.ncwf_id }}</p>
                                            <p class="font-bold text-sm text-gray-600 text-center">{{ work_role.ncwf_2025_work_role.ncwf_title }}</p>
                                            <input type="checkbox" name="ncwf_2025_{{ work_role.ncwf_2025_work_role.id }}"
                                                   class="form-checkbox h-5 w-5 text-purple-600 self-center mt-2">
                                            <p class="text-purple-600 text-xs font-semibold mt-1">NCWF 2025</p>
                                        {% endif %}
                                    </div>

                                    <!-- ZONE 2 - DCWF 2025 -->
                                    <div class="text-center px-5 py-1 flex flex-col justify-center">
                                        {% if work_role.dcwf_2025_work_role %}
                                            <p class="font-normal text-sm text-gray-600">{{ work_role.dcwf_2025_work_role.title }}</p>
                                            <input type="checkbox" name="dcwf_2025_{{ work_role.dcwf_2025_work_role.id }}"
                                                   class="form-checkbox h-5 w-5 text-indigo-600 self-center mt-2">
                                            <p class="text-indigo-600 text-xs font-semibold mt-1">DCWF 2025</p>
                                        {% endif %}
                                    </div>

                                    <!-- ZONE 3 - NCWF 2024 -->
                                    <div class="text-center px-5 py-1 flex flex-col justify-center">
                                        {% if work_role.ncwf_2024_work_role %}
                                            <p class="text-gray-500 text-sm font-medium">{{ work_role.ncwf_2024_work_role.nist_id }}</p>
                                            <p class="font-normal text-sm text-gray-600">{{ work_role.ncwf_2024_work_role.title }}</p>
                                            <input type="checkbox" name="ncwf_2024_{{ work_role.ncwf_2024_work_role.id }}"
                                                   class="form-checkbox h-5 w-5 text-red-600 self-center mt-2">
                                            <p class="text-red-600 text-xs font-semibold mt-1">NCWF 2024</p>
                                        {% endif %}
                                    </div>

                                    <!-- ZONE 4 - NCWF 2017 -->
                                    <div class="text-center px-5 py-1 flex flex-col justify-center">
                                        {% if work_role.ncwf_2017_work_role %}
                                            <p class="text-gray-500 text-sm font-medium">{{ work_role.ncwf_2017_work_role.nist_id }}</p>
                                            <p class="font-normal text-sm text-gray-600">{{ work_role.ncwf_2017_work_role.title }}</p>
                                            <input type="checkbox" name="ncwf_2017_{{ work_role.ncwf_2017_work_role.id }}"
                                                   class="form-checkbox h-5 w-5 text-green-600 self-center mt-2">
                                            <p class="text-green-600 text-xs font-semibold mt-1">NCWF 2017</p>
                                        {% endif %}
                                    </div>

                                    <!-- ZONE 5 - DCWF (le plus ancien) -->
                                    <div class="text-center px-5 pb-5 flex flex-col justify-center">
                                        <p class="font-normal text-base text-gray-600">{{ work_role.title }}</p>
                                        <input type="checkbox" name="dcwf_{{ work_role.id }}"
                                               class="form-checkbox h-5 w-5 text-blue-600 self-center mt-2">
                                        <p class="text-blue-600 text-xs font-semibold mt-1">DCWF 2017</p>
                                    </div>

                                    <!-- Données cachées -->
                                    <p class="hidden description">{{ work_role.description }}</p>
                                    <p class="hidden ksat-id">{{ item.ncwf_2017_ksat.ncwf_id }}</p>
                                    <p class="hidden dcwf-id">{{ item.dcwf_id }}</p>
                                    <p class="hidden description">{{ item.description }}</p>

                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endfor %}
            </div>

        {% elif category.title == "Intelligence (Cyberspace)" %}
            <div class="category-container rounded-lg mt-6 relative"
                 style="background-color: rgba({{ category.color }}, 0.75);"
                 id="category-{{ category.title|slugify }}">
                <!-- Titre + description TOUJOURS visibles -->
                <div class="category-content">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-white text-lg font-bold p-2 w-max rounded"
                         style="background-color: rgba({{ category.color }}, 1);">
                        {{ category.title }}
                        </div>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" 
                                   class="category-toggle mr-2 h-5 w-5 text-blue-600" 
                                   data-category="category-{{ category.title|slugify }}">
                            <span class="text-white font-medium">Dérouler</span>
                        </label>
                    </div>
                    <div class="text-white p-2">
                        {{ category.description }}
                    </div>
                </div>

                <!-- Rôles triés par ID prefix -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 mt-4 pt-6">
                    {% for work_role in intel_work_roles %}
                        <div class="bg-white rounded-lg shadow-md grid grid-rows-6 work-role relative"
                             id="work-role-{{ work_role.id }}" onclick="toggleDetail('{{ work_role.id }}')">

                            <!-- ZONE 0 - OPM ID (toujours visible) -->
                            <div class="px-5 pt-5 flex flex-col items-center justify-center">
                                <p class="font-semibold text-center"
                                   style="color: rgba({{ category.color }},1);">
                                    {% if work_role.opm.id in highlight_ids %}
                                        <span class="inline-block w-2 h-2 bg-red-600 rounded-full mr-2"></span>
                                    {% endif %}
                                    {{ work_role.opm.id }}
                                </p>
                            </div>

                            <!-- ZONE 1 - NCWF 2025 -->
                            <div class="px-5 py-1 flex flex-col items-center justify-center">
                                {% if work_role.ncwf_2025_work_role %}
                                    <p class="text-gray-500 text-sm font-medium text-center">{{ work_role.ncwf_2025_work_role.ncwf_id }}</p>
                                    <p class="font-bold text-sm text-gray-600 text-center">{{ work_role.ncwf_2025_work_role.ncwf_title }}</p>
                                    <input type="checkbox" name="ncwf_2025_{{ work_role.ncwf_2025_work_role.id }}"
                                           class="form-checkbox h-5 w-5 text-purple-600 self-center mt-2">
                                    <p class="text-purple-600 text-xs font-semibold mt-1">NCWF 2025</p>
                                {% endif %}
                            </div>

                            <!-- ZONE 2 - DCWF 2025 -->
                            <div class="text-center px-5 py-1 flex flex-col justify-center">
                                {% if work_role.dcwf_2025_work_role %}
                                    <p class="font-normal text-sm text-gray-600">{{ work_role.dcwf_2025_work_role.title }}</p>
                                    <input type="checkbox" name="dcwf_2025_{{ work_role.dcwf_2025_work_role.id }}"
                                           class="form-checkbox h-5 w-5 text-indigo-600 self-center mt-2">
                                    <p class="text-indigo-600 text-xs font-semibold mt-1">DCWF 2025</p>
                                {% endif %}
                            </div>

                            <!-- ZONE 3 - NCWF 2024 -->
                            <div class="text-center px-5 py-1 flex flex-col justify-center">
                                {% if work_role.ncwf_2024_work_role %}
                                    <p class="text-gray-500 text-sm font-medium">{{ work_role.ncwf_2024_work_role.nist_id }}</p>
                                    <p class="font-normal text-sm text-gray-600">{{ work_role.ncwf_2024_work_role.title }}</p>
                                    <input type="checkbox" name="ncwf_2024_{{ work_role.ncwf_2024_work_role.id }}"
                                           class="form-checkbox h-5 w-5 text-red-600 self-center mt-2">
                                    <p class="text-red-600 text-xs font-semibold mt-1">NCWF 2024</p>
                                {% endif %}
                            </div>

                            <!-- ZONE 4 - NCWF 2017 -->
                            <div class="text-center px-5 py-1 flex flex-col justify-center">
                                {% if work_role.ncwf_2017_work_role %}
                                    <p class="text-gray-500 text-sm font-medium">{{ work_role.ncwf_2017_work_role.nist_id }}</p>
                                    <p class="font-normal text-sm text-gray-600">{{ work_role.ncwf_2017_work_role.title }}</p>
                                    <input type="checkbox" name="ncwf_2017_{{ work_role.ncwf_2017_work_role.id }}"
                                           class="form-checkbox h-5 w-5 text-green-600 self-center mt-2">
                                    <p class="text-green-600 text-xs font-semibold mt-1">NCWF 2017</p>
                                {% endif %}
                            </div>

                            <!-- ZONE 5 - DCWF (le plus ancien) -->
                            <div class="text-center px-5 pb-5 flex flex-col justify-center">
                                <p class="font-normal text-base text-gray-600">{{ work_role.title }}</p>
                                <input type="checkbox" name="dcwf_{{ work_role.id }}"
                                       class="form-checkbox h-5 w-5 text-blue-600 self-center mt-2">
                                <p class="text-blue-600 text-xs font-semibold mt-1">DCWF 2017</p>
                            </div>

                            <!-- Données cachées -->
                            <p class="hidden description">{{ work_role.description }}</p>
                            <p class="hidden ksat-id">{{ item.ncwf_2017_ksat.ncwf_id }}</p>
                            <p class="hidden dcwf-id">{{ item.dcwf_id }}</p>
                            <p class="hidden description">{{ item.description }}</p>

                        </div>
                    {% endfor %}
                </div>
            </div>

        {% elif category.title == "Cyberspace Enablers" %}
            <div class="category-container rounded-lg mt-6 relative"
                 style="background-color: rgba({{ category.color }}, 0.75);"
                 id="category-{{ category.title|slugify }}">
                <!-- Titre + description TOUJOURS visibles -->
                <div class="category-content">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-white text-lg font-bold p-2 w-max rounded"
                         style="background-color: rgba({{ category.color }}, 1);">
                        {{ category.title }}
                        </div>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" 
                                   class="category-toggle mr-2 h-5 w-5 text-blue-600" 
                                   data-category="category-{{ category.title|slugify }}">
                            <span class="text-white font-medium">Dérouler</span>
                        </label>
                    </div>
                    <div class="text-white p-2">
                        {{ category.description }}
                    </div>
                </div>

                <!-- Rôles triés par ID prefix -->
                {% for line in enabler_work_lines %}
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 mt-4 pt-6">
                        {% for work_role in line %}
                            {% if work_role == None %}
                                <div class="col-span-1"></div>  {# Espace vide, transparent #}
                            {% else %}
                                <!-- Conteneur relatif pour positionner le detail-box -->
                        <div class="bg-white rounded-lg shadow-md grid grid-rows-6 work-role relative"
                             id="work-role-{{ work_role.id }}" onclick="toggleDetail('{{ work_role.id }}')">

                            <!-- ZONE 0 - OPM ID (toujours visible) -->
                            <div class="px-5 pt-5 flex flex-col items-center justify-center">
                                <p class="font-semibold text-center"
                                   style="color: rgba({{ category.color }},1);">
                                    {% if work_role.opm.id in highlight_ids %}
                                        <span class="inline-block w-2 h-2 bg-red-600 rounded-full mr-2"></span>
                                    {% endif %}
                                    {{ work_role.opm.id }}
                                </p>
                            </div>

                            <!-- ZONE 1 - NCWF 2025 -->
                            <div class="px-5 py-1 flex flex-col items-center justify-center">
                                {% if work_role.ncwf_2025_work_role %}
                                    <p class="text-gray-500 text-sm font-medium text-center">{{ work_role.ncwf_2025_work_role.ncwf_id }}</p>
                                    <p class="font-bold text-sm text-gray-600 text-center">{{ work_role.ncwf_2025_work_role.ncwf_title }}</p>
                                    <input type="checkbox" name="ncwf_2025_{{ work_role.ncwf_2025_work_role.id }}"
                                           class="form-checkbox h-5 w-5 text-purple-600 self-center mt-2">
                                            <p class="text-purple-600 text-xs font-semibold mt-1">NCWF 2025</p>
                                {% endif %}
                            </div>

                            <!-- ZONE 2 - DCWF 2025 -->
                            <div class="text-center px-5 py-1 flex flex-col justify-center">
                                {% if work_role.dcwf_2025_work_role %}
                                    <p class="font-normal text-sm text-gray-600">{{ work_role.dcwf_2025_work_role.title }}</p>
                                    <input type="checkbox" name="dcwf_2025_{{ work_role.dcwf_2025_work_role.id }}"
                                           class="form-checkbox h-5 w-5 text-indigo-600 self-center mt-2">
                                            <p class="text-indigo-600 text-xs font-semibold mt-1">DCWF 2025</p>
                                {% endif %}
                            </div>

                            <!-- ZONE 3 - NCWF 2024 -->
                            <div class="text-center px-5 py-1 flex flex-col justify-center">
                                {% if work_role.ncwf_2024_work_role %}
                                    <p class="text-gray-500 text-sm font-medium">{{ work_role.ncwf_2024_work_role.nist_id }}</p>
                                    <p class="font-normal text-sm text-gray-600">{{ work_role.ncwf_2024_work_role.title }}</p>
                                    <input type="checkbox" name="ncwf_2024_{{ work_role.ncwf_2024_work_role.id }}"
                                           class="form-checkbox h-5 w-5 text-red-600 self-center mt-2">
                                            <p class="text-red-600 text-xs font-semibold mt-1">NCWF 2024</p>
                                {% endif %}
                            </div>

                            <!-- ZONE 4 - NCWF 2017 -->
                            <div class="text-center px-5 py-1 flex flex-col justify-center">
                                {% if work_role.ncwf_2017_work_role %}
                                    <p class="text-gray-500 text-sm font-medium">{{ work_role.ncwf_2017_work_role.nist_id }}</p>
                                    <p class="font-normal text-sm text-gray-600">{{ work_role.ncwf_2017_work_role.title }}</p>
                                    <input type="checkbox" name="ncwf_2017_{{ work_role.ncwf_2017_work_role.id }}"
                                           class="form-checkbox h-5 w-5 text-green-600 self-center mt-2">
                                            <p class="text-green-600 text-xs font-semibold mt-1">NCWF 2017</p>
                                {% endif %}
                            </div>

                            <!-- ZONE 5 - DCWF (le plus ancien) -->
                            <div class="text-center px-5 pb-5 flex flex-col justify-center">
                                <p class="font-normal text-base text-gray-600">{{ work_role.title }}</p>
                                <input type="checkbox" name="dcwf_{{ work_role.id }}"
                                       class="form-checkbox h-5 w-5 text-blue-600 self-center mt-2">
                                        <p class="text-blue-600 text-xs font-semibold mt-1">DCWF 2017</p>
                            </div>

                            <!-- Données cachées -->
                            <p class="hidden description">{{ work_role.description }}</p>
                            <p class="hidden ksat-id">{{ item.ncwf_2017_ksat.ncwf_id }}</p>
                            <p class="hidden dcwf-id">{{ item.dcwf_id }}</p>
                            <p class="hidden description">{{ item.description }}</p>

                        </div>
                            {% endif %}
                    {% endfor %}
                </div>
                {% endfor %}
            </div>

        {% elif category.title == "Software Engineering" %}
            <div class="category-container rounded-lg mt-6 relative"
                 style="background-color: rgba({{ category.color }}, 0.75);"
                 id="category-{{ category.title|slugify }}">
                <!-- Titre + description TOUJOURS visibles -->
                <div class="category-content">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-white text-lg font-bold p-2 w-max rounded"
                         style="background-color: rgba({{ category.color }}, 1);">
                        {{ category.title }}
                        </div>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" 
                                   class="category-toggle mr-2 h-5 w-5 text-blue-600" 
                                   data-category="category-{{ category.title|slugify }}">
                            <span class="text-white font-medium">Dérouler</span>
                        </label>
                    </div>
                    <div class="text-white p-2">
                        {{ category.description }}
                    </div>
                </div>

                <!-- Rôles triés par ID prefix -->
                {% for line in software_engineering_work_lines %}
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 mt-4 pt-6">
                        {% for work_role in line %}
                            {% if work_role == None %}
                                <div class="col-span-1"></div>  {# Espace vide, transparent #}
                            {% else %}
                                <!-- Conteneur relatif pour positionner le detail-box -->
                                <div class="bg-white rounded-lg shadow-md grid grid-rows-6 work-role relative"
                                     id="work-role-{{ work_role.id }}" onclick="toggleDetail('{{ work_role.id }}')">

                                    <!-- ZONE 0 - OPM ID (toujours visible) -->
                                    <div class="px-5 pt-5 flex flex-col items-center justify-center">
                                        <p class="font-semibold text-center"
                                           style="color: rgba({{ category.color }},1);">
                                            {% if work_role.opm.id in highlight_ids %}
                                                <span class="inline-block w-2 h-2 bg-red-600 rounded-full mr-2"></span>
                                            {% endif %}
                                            {{ work_role.opm.id }}
                                        </p>
                                    </div>

                                    <!-- ZONE 1 - NCWF 2025 -->
                                    <div class="px-5 py-1 flex flex-col items-center justify-center">
                                        {% if work_role.ncwf_2025_work_role %}
                                            <p class="text-gray-500 text-sm font-medium text-center">{{ work_role.ncwf_2025_work_role.ncwf_id }}</p>
                                            <p class="font-bold text-sm text-gray-600 text-center">{{ work_role.ncwf_2025_work_role.ncwf_title }}</p>
                                            <input type="checkbox" name="ncwf_2025_{{ work_role.ncwf_2025_work_role.id }}"
                                                   class="form-checkbox h-5 w-5 text-purple-600 self-center mt-2">
                                            <p class="text-purple-600 text-xs font-semibold mt-1">NCWF 2025</p>
                                        {% endif %}
                                    </div>

                                    <!-- ZONE 2 - DCWF 2025 -->
                                    <div class="text-center px-5 py-1 flex flex-col justify-center">
                                        {% if work_role.dcwf_2025_work_role %}
                                            <p class="font-normal text-sm text-gray-600">{{ work_role.dcwf_2025_work_role.title }}</p>
                                            <input type="checkbox" name="dcwf_2025_{{ work_role.dcwf_2025_work_role.id }}"
                                                   class="form-checkbox h-5 w-5 text-indigo-600 self-center mt-2">
                                            <p class="text-indigo-600 text-xs font-semibold mt-1">DCWF 2025</p>
                                        {% endif %}
                                    </div>

                                    <!-- ZONE 3 - NCWF 2024 -->
                                    <div class="text-center px-5 py-1 flex flex-col justify-center">
                                        {% if work_role.ncwf_2024_work_role %}
                                            <p class="text-gray-500 text-sm font-medium">{{ work_role.ncwf_2024_work_role.nist_id }}</p>
                                            <p class="font-normal text-sm text-gray-600">{{ work_role.ncwf_2024_work_role.title }}</p>
                                            <input type="checkbox" name="ncwf_2024_{{ work_role.ncwf_2024_work_role.id }}"
                                                   class="form-checkbox h-5 w-5 text-red-600 self-center mt-2">
                                            <p class="text-red-600 text-xs font-semibold mt-1">NCWF 2024</p>
                                        {% endif %}
                                    </div>

                                    <!-- ZONE 4 - NCWF 2017 -->
                                    <div class="text-center px-5 py-1 flex flex-col justify-center">
                                        {% if work_role.ncwf_2017_work_role %}
                                            <p class="text-gray-500 text-sm font-medium">{{ work_role.ncwf_2017_work_role.nist_id }}</p>
                                            <p class="font-normal text-sm text-gray-600">{{ work_role.ncwf_2017_work_role.title }}</p>
                                            <input type="checkbox" name="ncwf_2017_{{ work_role.ncwf_2017_work_role.id }}"
                                                   class="form-checkbox h-5 w-5 text-green-600 self-center mt-2">
                                            <p class="text-green-600 text-xs font-semibold mt-1">NCWF 2017</p>
                                        {% endif %}
                                    </div>

                                    <!-- ZONE 5 - DCWF (le plus ancien) -->
                                    <div class="text-center px-5 pb-5 flex flex-col justify-center">
                                        <p class="font-normal text-base text-gray-600">{{ work_role.title }}</p>
                                        <input type="checkbox" name="dcwf_{{ work_role.id }}"
                                               class="form-checkbox h-5 w-5 text-blue-600 self-center mt-2">
                                        <p class="text-blue-600 text-xs font-semibold mt-1">DCWF 2017</p>
                                    </div>

                                    <!-- Données cachées -->
                                    <p class="hidden description">{{ work_role.description }}</p>
                                    <p class="hidden ksat-id">{{ item.ncwf_2017_ksat.ncwf_id }}</p>
                                    <p class="hidden dcwf-id">{{ item.dcwf_id }}</p>
                                    <p class="hidden description">{{ item.description }}</p>

            </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endfor %}
            </div>

        {% elif category.title == "Data/AI" %}
            <div class="category-container rounded-lg mt-6 relative"
                 style="background-color: rgba({{ category.color }}, 0.75);"
                 id="category-{{ category.title|slugify }}">
                <!-- Titre + description TOUJOURS visibles -->
                <div class="category-content">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-white text-lg font-bold p-2 w-max rounded"
                         style="background-color: rgba({{ category.color }}, 1);">
                        {{ category.title }}
                        </div>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" 
                                   class="category-toggle mr-2 h-5 w-5 text-blue-600" 
                                   data-category="category-{{ category.title|slugify }}">
                            <span class="text-white font-medium">Dérouler</span>
                        </label>
                    </div>
                    <div class="text-white p-2">
                        {{ category.description }}
                    </div>
                </div>

                <!-- Rôles triés par ID prefix -->
                {% for line in data_work_lines %}
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 mt-4 pt-6">
                        {% for work_role in line %}
                            {% if work_role == None %}
                                <div class="col-span-1"></div>  {# Espace vide, transparent #}
                            {% else %}
                                <!-- Conteneur relatif pour positionner le detail-box -->
                                <div class="bg-white rounded-lg shadow-md grid grid-rows-6 work-role relative"
                                     id="work-role-{{ work_role.id }}" onclick="toggleDetail('{{ work_role.id }}')">

                                    <!-- ZONE 0 - OPM ID (toujours visible) -->
                                    <div class="px-5 pt-5 flex flex-col items-center justify-center">
                                        <p class="font-semibold text-center"
                                           style="color: rgba({{ category.color }},1);">
                                            {% if work_role.opm.id in highlight_ids %}
                                                <span class="inline-block w-2 h-2 bg-red-600 rounded-full mr-2"></span>
                                            {% endif %}
                                            {{ work_role.opm.id }}
                                        </p>
                                    </div>

                                    <!-- ZONE 1 - NCWF 2025 -->
                                    <div class="px-5 py-1 flex flex-col items-center justify-center">
                                        {% if work_role.ncwf_2025_work_role %}
                                            <p class="text-gray-500 text-sm font-medium text-center">{{ work_role.ncwf_2025_work_role.ncwf_id }}</p>
                                            <p class="font-bold text-sm text-gray-600 text-center">{{ work_role.ncwf_2025_work_role.ncwf_title }}</p>
                                            <input type="checkbox" name="ncwf_2025_{{ work_role.ncwf_2025_work_role.id }}"
                                                   class="form-checkbox h-5 w-5 text-purple-600 self-center mt-2">
                                            <p class="text-purple-600 text-xs font-semibold mt-1">NCWF 2025</p>
                                        {% endif %}
                                    </div>

                                    <!-- ZONE 2 - DCWF 2025 -->
                                    <div class="text-center px-5 py-1 flex flex-col justify-center">
                                        {% if work_role.dcwf_2025_work_role %}
                                            <p class="font-normal text-sm text-gray-600">{{ work_role.dcwf_2025_work_role.title }}</p>
                                            <input type="checkbox" name="dcwf_2025_{{ work_role.dcwf_2025_work_role.id }}"
                                                   class="form-checkbox h-5 w-5 text-indigo-600 self-center mt-2">
                                            <p class="text-indigo-600 text-xs font-semibold mt-1">DCWF 2025</p>
                                        {% endif %}
                                    </div>

                                    <!-- ZONE 3 - NCWF 2024 -->
                                    <div class="text-center px-5 py-1 flex flex-col justify-center">
                                        {% if work_role.ncwf_2024_work_role %}
                                            <p class="text-gray-500 text-sm font-medium">{{ work_role.ncwf_2024_work_role.nist_id }}</p>
                                            <p class="font-normal text-sm text-gray-600">{{ work_role.ncwf_2024_work_role.title }}</p>
                                            <input type="checkbox" name="ncwf_2024_{{ work_role.ncwf_2024_work_role.id }}"
                                                   class="form-checkbox h-5 w-5 text-red-600 self-center mt-2">
                                            <p class="text-red-600 text-xs font-semibold mt-1">NCWF 2024</p>
                                        {% endif %}
                                    </div>

                                    <!-- ZONE 4 - NCWF 2017 -->
                                    <div class="text-center px-5 py-1 flex flex-col justify-center">
                                        {% if work_role.ncwf_2017_work_role %}
                                            <p class="text-gray-500 text-sm font-medium">{{ work_role.ncwf_2017_work_role.nist_id }}</p>
                                            <p class="font-normal text-sm text-gray-600">{{ work_role.ncwf_2017_work_role.title }}</p>
                                            <input type="checkbox" name="ncwf_2017_{{ work_role.ncwf_2017_work_role.id }}"
                                                   class="form-checkbox h-5 w-5 text-green-600 self-center mt-2">
                                            <p class="text-green-600 text-xs font-semibold mt-1">NCWF 2017</p>
                                        {% endif %}
                                    </div>

                                    <!-- ZONE 5 - DCWF (le plus ancien) -->
                                    <div class="text-center px-5 pb-5 flex flex-col justify-center">
                                        <p class="font-normal text-base text-gray-600">{{ work_role.title }}</p>
                                        <input type="checkbox" name="dcwf_{{ work_role.id }}"
                                               class="form-checkbox h-5 w-5 text-blue-600 self-center mt-2">
                                        <p class="text-blue-600 text-xs font-semibold mt-1">DCWF 2017</p>
                                    </div>

                                    <!-- Données cachées -->
                                    <p class="hidden description">{{ work_role.description }}</p>
                                    <p class="hidden ksat-id">{{ item.ncwf_2017_ksat.ncwf_id }}</p>
                                    <p class="hidden dcwf-id">{{ item.dcwf_id }}</p>
                                    <p class="hidden description">{{ item.description }}</p>

                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endfor %}
            </div>

        {% endif %}
    {% endfor %}

    <!-- Div caché pour afficher plus de détails (commun à toutes les catégories) -->
    <div id="detail-box"
         class="detail-box hidden fixed right-0 top-0 h-full w-[400px] p-6 shadow-xl overflow-y-auto z-50">
        <button onclick="toggleDetail(null)" class="text-red-500 font-bold float-right">X</button>
        <div id="detail-box-content"></div>
    </div>

    </main>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Gestion des cases à cocher pour le déroulement des catégories
        document.querySelectorAll('.category-toggle').forEach(checkbox => {
            checkbox.addEventListener('change', function(event) {
                const categoryId = this.getAttribute('data-category');
                const categoryContainer = document.getElementById(categoryId);
                
                if (categoryContainer) {
                    if (this.checked) {
                        categoryContainer.classList.add('expanded');
                    } else {
                        categoryContainer.classList.remove('expanded');
                    }
                }
                
                // Empêcher la propagation du clic
                event.stopPropagation();
            });
            
            // Empêcher que le clic sur la case à cocher déclenche d'autres événements
            checkbox.addEventListener('click', function(event) {
                event.stopPropagation();
            });
        });

        // Gestion des clics sur les work roles pour afficher les détails
        document.querySelectorAll('.work-role').forEach(workRole => {
            workRole.addEventListener('click', function(event) {
                // Ne pas déclencher si on clique sur une checkbox
                if (event.target.type === 'checkbox') {
                    return;
                }
                
                const workRoleId = this.id.replace('work-role-', '');
                toggleDetail(workRoleId);
            });
        });

        // Gestion des checkboxes : afficher la fenêtre de détails quand on clique sur une checkbox
        document.querySelectorAll('.work-role input[type="checkbox"]:not(.model-toggle)').forEach(checkbox => {
            checkbox.addEventListener('click', function(event) {
                // Empêcher la propagation pour éviter le double événement
                event.stopPropagation();
                
                // Trouver le work role parent et ouvrir sa fenêtre de détails
                const workRole = this.closest('.work-role');
                if (workRole) {
                    const workRoleId = workRole.id.replace('work-role-', '');
                    toggleDetail(workRoleId);
                }
            });
        });

        // Initialiser le bouton de comparaison
        // updateCompareButton(); // Supprimé car plus de bouton de comparaison
        
        // Gestion des sélecteurs de modèles (zone de sélection uniquement)
        document.querySelectorAll('.model-toggle').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const modelType = this.getAttribute('data-model');
                const isChecked = this.checked;
                
                // Empêcher la désélection complète (minimum 1 modèle)
                // Si on essaie de décocher et qu'il n'y aura plus aucune case cochée
                if (!isChecked) {
                    const otherCheckedBoxes = document.querySelectorAll('.model-toggle:checked:not([data-model="' + modelType + '"])');
                    if (otherCheckedBoxes.length === 0) {
                        this.checked = true; // Remettre la case cochée
                        alert('Au moins un modèle doit être sélectionné pour éviter la confusion !');
                        return;
                    }
                }
                
                // Masquer/afficher les zones correspondantes
                toggleModelVisibility(modelType, isChecked);
                
                // Ajuster la taille des work roles
                adjustWorkRoleHeights();
            });
        });
        
        // Initialiser les modèles par défaut (DCWF 2025 et NCWF 2025)
        initializeDefaultModelSelectors();
        
        // Ajuster la taille initiale
        adjustWorkRoleHeights();
        adjustLongTitleWorkRoles();
        
        // Ajouter des event listeners sur TOUS les checkboxes des work roles pour l'adaptation en temps réel
        const allWorkRoleCheckboxes = document.querySelectorAll('.work-role input[type="checkbox"]');
        allWorkRoleCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                // Ajuster les hauteurs en temps réel quand l'utilisateur coche/décoche
                setTimeout(() => {
                    adjustWorkRoleHeights();
                    // Ajustement spécial pour les work roles avec des titres longs
                    adjustLongTitleWorkRoles();
                }, 10);
            });
        });
    });

    // Fonction pour masquer/afficher les zones selon le modèle sélectionné
    function toggleModelVisibility(modelType, isVisible) {
        const workRoles = document.querySelectorAll('.work-role');
        
        workRoles.forEach(workRole => {
            let targetZone;
            
            switch(modelType) {
                case 'ncwf-2025':
                    // Chercher la zone NCWF 2025 par le nom du checkbox
                    const ncwf25Checkbox = workRole.querySelector('input[name^="ncwf_2025_"]');
                    if (ncwf25Checkbox) targetZone = ncwf25Checkbox.closest('div');
                    break;
                case 'dcwf-2025':
                    // Chercher la zone DCWF 2025 par le nom du checkbox
                    const dcwf25Checkbox = workRole.querySelector('input[name^="dcwf_2025_"]');
                    if (dcwf25Checkbox) targetZone = dcwf25Checkbox.closest('div');
                    break;
                case 'ncwf-2024':
                    // Chercher la zone NCWF 2024 par le nom du checkbox
                    const ncwf24Checkbox = workRole.querySelector('input[name^="ncwf_2024_"]');
                    if (ncwf24Checkbox) targetZone = ncwf24Checkbox.closest('div');
                    break;
                case 'ncwf-2017':
                    // Chercher la zone NCWF 2017 par le nom du checkbox
                    const ncwf17Checkbox = workRole.querySelector('input[name^="ncwf_2017_"]');
                    if (ncwf17Checkbox) targetZone = ncwf17Checkbox.closest('div');
                    break;
                case 'dcwf-2017':
                    // Chercher la zone DCWF 2017 par le nom du checkbox (sans année)
                    const workRoleId = workRole.id.replace("work-role-", "");
                    const dcwf17Checkbox = workRole.querySelector(`input[name="dcwf_${workRoleId}"]`);
                    if (dcwf17Checkbox) targetZone = dcwf17Checkbox.closest('div');
                    break;
            }
            
            if (targetZone) {
                if (isVisible) {
                    targetZone.style.display = 'flex';
                } else {
                    targetZone.style.display = 'none';
                }
            }
        });
        
        // Ajuster les hauteurs après avoir changé la visibilité
        setTimeout(() => {
            adjustWorkRoleHeights();
        }, 50);
    }

    // Fonction pour afficher/masquer la fenêtre de détails (renommée pour éviter le conflit)
    function toggleDetailHome(workRoleId) {
        // Utiliser la fonction de base.html qui gère l'affichage
        toggleDetail(workRoleId);
    }
    
    // Fonction pour ajuster la hauteur des work roles selon le contenu réel
    function adjustWorkRoleHeights() {
        const workRoles = document.querySelectorAll('.work-role');
        
        workRoles.forEach(workRole => {
            // Temporairement mettre la hauteur en auto pour mesurer le contenu réel
            workRole.style.height = 'auto';
            workRole.style.minHeight = 'auto';
            
            // Récupérer toutes les zones visibles
            const visibleZones = [];
            const zones = workRole.querySelectorAll('div');
            
            // Zone 0 (OPM ID) toujours visible
            const opmZone = zones[0];
            if (opmZone) visibleZones.push(opmZone);
            
            // Vérifier chaque zone de modèle (1 à 5) en utilisant les checkboxes pour identifier les zones
            // Zone 1 - NCWF 2025
            const ncwf25Checkbox = workRole.querySelector('input[name^="ncwf_2025_"]');
            if (ncwf25Checkbox && window.getComputedStyle(ncwf25Checkbox.closest('div')).display !== 'none') {
                visibleZones.push(ncwf25Checkbox.closest('div'));
            }
            
            // Zone 2 - DCWF 2025
            const dcwf25Checkbox = workRole.querySelector('input[name^="dcwf_2025_"]');
            if (dcwf25Checkbox && window.getComputedStyle(dcwf25Checkbox.closest('div')).display !== 'none') {
                visibleZones.push(dcwf25Checkbox.closest('div'));
            }
            
            // Zone 3 - NCWF 2024
            const ncwf24Checkbox = workRole.querySelector('input[name^="ncwf_2024_"]');
            if (ncwf24Checkbox && window.getComputedStyle(ncwf24Checkbox.closest('div')).display !== 'none') {
                visibleZones.push(ncwf24Checkbox.closest('div'));
            }
            
            // Zone 4 - NCWF 2017
            const ncwf17Checkbox = workRole.querySelector('input[name^="ncwf_2017_"]');
            if (ncwf17Checkbox && window.getComputedStyle(ncwf17Checkbox.closest('div')).display !== 'none') {
                visibleZones.push(ncwf17Checkbox.closest('div'));
            }
            
            // Zone 5 - DCWF 2017 (utiliser l'ID du work role)
            const workRoleId = workRole.id.replace("work-role-", "");
            const dcwf17Checkbox = workRole.querySelector(`input[name="dcwf_${workRoleId}"]`);
            if (dcwf17Checkbox && window.getComputedStyle(dcwf17Checkbox.closest('div')).display !== 'none') {
                visibleZones.push(dcwf17Checkbox.closest('div'));
            }
            
            // Calculer la hauteur réelle du contenu
            let totalHeight = 0;
            let totalPadding = 0;
            
            visibleZones.forEach((zone, index) => {
                // Mesurer la hauteur réelle de la zone
                const zoneHeight = zone.scrollHeight;
                const computedStyle = window.getComputedStyle(zone);
                const paddingTop = parseFloat(computedStyle.paddingTop);
                const paddingBottom = parseFloat(computedStyle.paddingBottom);
                
                totalHeight += zoneHeight;
                totalPadding += paddingTop + paddingBottom;
                
                // Ajouter un petit espacement entre les zones (sauf pour la dernière)
                if (index < visibleZones.length - 1) {
                    totalHeight += 6; // 6px d'espacement entre zones (réduit)
                }
            });
            
            // Ajouter un padding minimal pour l'esthétique et s'assurer qu'il y a assez d'espace
            const aestheticPadding = 20; // 10px en haut et 10px en bas (augmenté)
            const finalHeight = Math.max(120, totalHeight + aestheticPadding + 10); // +10px de sécurité
            
            // Appliquer la hauteur calculée
            workRole.style.height = `${finalHeight}px`;
            workRole.style.minHeight = `${finalHeight}px`;
            
            // Ajuster le grid-rows pour correspondre au nombre de zones visibles
            workRole.style.gridTemplateRows = `repeat(${visibleZones.length}, 1fr)`;
        });
    }
    
    // Fonction spéciale pour ajuster les work roles avec des titres longs
    function adjustLongTitleWorkRoles() {
        const workRoles = document.querySelectorAll('.work-role');
        
        workRoles.forEach(workRole => {
            // Vérifier si la zone DCWF 2017 est visible
            const workRoleId = workRole.id.replace("work-role-", "");
            const dcwf17Checkbox = workRole.querySelector(`input[name="dcwf_${workRoleId}"]`);
            
            if (dcwf17Checkbox && window.getComputedStyle(dcwf17Checkbox.closest('div')).display !== 'none') {
                const dcwf17Zone = dcwf17Checkbox.closest('div');
                const titleElement = dcwf17Zone.querySelector('p');
                
                if (titleElement) {
                    // Mesurer la hauteur du texte
                    const textHeight = titleElement.scrollHeight;
                    const lineHeight = parseFloat(window.getComputedStyle(titleElement).lineHeight);
                    const lines = Math.ceil(textHeight / lineHeight);
                    
                    // Si le texte fait plus d'une ligne, ajuster la hauteur
                    if (lines > 1) {
                        const additionalHeight = (lines - 1) * lineHeight + 20; // 20px de marge supplémentaire
                        const currentHeight = parseInt(workRole.style.height) || 120;
                        workRole.style.height = `${currentHeight + additionalHeight}px`;
                        workRole.style.minHeight = `${currentHeight + additionalHeight}px`;
                    }
                }
            }
        });
    }

    // Fonction pour initialiser les modèles par défaut (DCWF 2025 et NCWF 2025 uniquement)
    function initializeDefaultModelSelectors() {
        // D'abord, masquer toutes les zones
        hideAllModelZones();
        
        // Cocher DCWF 2025 par défaut
        const dcwf25Checkboxes = document.querySelectorAll('input[data-model="dcwf-2025"]');
        dcwf25Checkboxes.forEach(checkbox => {
            checkbox.checked = true;
            checkbox.dispatchEvent(new Event('change'));
        });
        
        // Cocher NCWF 2025 par défaut
        const ncwf25Checkboxes = document.querySelectorAll('input[data-model="ncwf-2025"]');
        ncwf25Checkboxes.forEach(checkbox => {
            checkbox.checked = true;
            checkbox.dispatchEvent(new Event('change'));
        });
        
        // DCWF 2017 reste décoché par défaut
    }
    
    // Fonction pour masquer toutes les zones de modèles
    function hideAllModelZones() {
        const workRoles = document.querySelectorAll('.work-role');
        
        workRoles.forEach(workRole => {
            // Masquer NCWF 2025
            const ncwf25Checkbox = workRole.querySelector('input[name^="ncwf_2025_"]');
            if (ncwf25Checkbox) {
                const zone = ncwf25Checkbox.closest('div');
                if (zone) zone.style.display = 'none';
            }
            
            // Masquer DCWF 2025
            const dcwf25Checkbox = workRole.querySelector('input[name^="dcwf_2025_"]');
            if (dcwf25Checkbox) {
                const zone = dcwf25Checkbox.closest('div');
                if (zone) zone.style.display = 'none';
            }
            
            // Masquer NCWF 2024
            const ncwf24Checkbox = workRole.querySelector('input[name^="ncwf_2024_"]');
            if (ncwf24Checkbox) {
                const zone = ncwf24Checkbox.closest('div');
                if (zone) zone.style.display = 'none';
            }
            
            // Masquer NCWF 2017
            const ncwf17Checkbox = workRole.querySelector('input[name^="ncwf_2017_"]');
            if (ncwf17Checkbox) {
                const zone = ncwf17Checkbox.closest('div');
                if (zone) zone.style.display = 'none';
            }
            
            // Masquer DCWF 2017 (utiliser l'ID du work role)
            const workRoleId = workRole.id.replace("work-role-", "");
            const dcwf17Checkbox = workRole.querySelector(`input[name="dcwf_${workRoleId}"]`);
            if (dcwf17Checkbox) {
                const zone = dcwf17Checkbox.closest('div');
                if (zone) zone.style.display = 'none';
            }
        });
        
        // Ajuster les hauteurs après avoir masqué toutes les zones
        setTimeout(() => {
            adjustWorkRoleHeights();
        }, 50);
    }
    
    // Fonction pour compter le nombre de modèles cochés dans la zone de sélection
    function getCheckedModelSelectorsCount() {
        const checkedCheckboxes = document.querySelectorAll('.model-toggle:checked');
        return checkedCheckboxes.length;
    }
</script>

<style>
    /* Styles pour les work roles vraiment adaptatifs */
    .work-role {
        min-height: 120px; /* Hauteur minimale augmentée */
        transition: all 0.3s ease;
        height: auto; /* Hauteur flexible */
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        overflow: visible; /* Permettre le débordement si nécessaire */
    }
    
    /* Optimiser l'espacement des zones */
    .work-role > div {
        padding: 0.4rem !important; /* Padding encore plus réduit */
        flex-shrink: 0; /* Empêcher la compression */
        min-height: fit-content; /* S'assurer que la zone s'adapte au contenu */
    }
    
    .work-role > div:first-child {
        padding-top: 0.75rem !important; /* Zone OPM ID */
        padding-bottom: 0.25rem !important;
    }
    
    .work-role > div:last-child {
        padding-bottom: 1rem !important; /* Zone DCWF 2017 - plus d'espace en bas */
        padding-top: 0.25rem !important;
        margin-bottom: 0.5rem !important; /* Marge supplémentaire en bas */
    }
    
    /* Assurer que le contenu s'adapte */
    .work-role > div > p {
        margin: 0.1rem 0 !important; /* Marges encore plus minimales */
        line-height: 1.1 !important; /* Ligne de base plus compacte */
        word-wrap: break-word; /* Permettre la coupure des mots longs */
        overflow-wrap: break-word;
    }
    
    .work-role > div > input {
        margin: 0.2rem 0 !important; /* Marge minimale pour les checkboxes */
    }
    
    /* Spécifiquement pour les zones DCWF 2017 qui ont des titres plus longs */
    .work-role > div:last-child > p {
        font-size: 0.875rem !important; /* Taille de police légèrement réduite */
        line-height: 1.1 !important;
        max-height: none !important; /* Pas de limite de hauteur */
    }
    
    .work-role:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }
    
    /* Couleurs distinctes pour chaque zone */
    .work-role input[name^="dcwf_"]:not([name*="2025"]) {
        border-color: #3b82f6; /* Bleu pour DCWF */
    }
    
    .work-role input[name^="ncwf_2017_"] {
        border-color: #10b981; /* Vert pour NCWF 2017 */
    }
    
    .work-role input[name^="ncwf_2024_"] {
        border-color: #ef4444; /* Rouge pour NCWF 2024 */
    }
    
    .work-role input[name^="dcwf_2025_"] {
        border-color: #6366f1; /* Indigo pour DCWF 2025 */
    }
    
    .work-role input[name^="ncwf_2025_"] {
        border-color: #8b5cf6; /* Violet pour NCWF 2025 */
    }
    
    /* Masquer les work roles par défaut */
    .category-container .work-role-container {
        display: none;
    }
    
    /* Afficher les work roles quand la catégorie est expanded */
    .category-container.expanded .work-role-container {
        display: grid;
    }
    
            /* Animation pour le detail box */
        .detail-box {
            max-width: 350px;
            max-height: 70vh;
            overflow-y: auto;
            border: 1px solid #e5e7eb;
            /* Améliorer le positionnement */
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            /* Ajouter une ombre pour mieux le distinguer */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            /* Améliorer l'apparence */
            border-radius: 12px;
            background: white;
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(-50%) translateX(20px);
        }
        
        .detail-box:not(.hidden) {
            opacity: 1;
            transform: translateY(-50%) translateX(0);
        }
</style>

{% endblock %}
